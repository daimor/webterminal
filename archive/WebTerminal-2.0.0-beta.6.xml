<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="%WebTerminal.Engine">
<Description>
This class represents the core of web terminal.</Description>
<Super>%CSP.WebSocket,%Library.Routine</Super>
<TimeCreated>63047,60359.445979</TimeCreated>

<UDLText name="T">
<Content><![CDATA[
// CONSTANTS BEGIN

]]></Content>
</UDLText>

<Parameter name="authorizationTimeout">
<Description>
How long to wait for authorization key when connection established</Description>
<Default>5</Default>
</Parameter>

<Property name="ConstServerActionExecute">
<Type>%Char</Type>
<InitialExpression>"EXEC"</InitialExpression>
</Property>

<Property name="ConstServerActionExecuteSQL">
<Type>%Char</Type>
<InitialExpression>"SQL"</InitialExpression>
</Property>

<Property name="ConstServerActionGenerateAutocomplete">
<Type>%Char</Type>
<InitialExpression>"AC"</InitialExpression>
</Property>

<Property name="ConstServerActionTrace">
<Type>%Char</Type>
<InitialExpression>"TRACE"</InitialExpression>
</Property>

<Property name="ConstServerActionStopTraceAll">
<Type>%Char</Type>
<InitialExpression>"STOP_TRACE_ALL"</InitialExpression>
</Property>

<Property name="ConstServerActionCheckTrace">
<Type>%Char</Type>
<InitialExpression>"CT"</InitialExpression>
</Property>

<Property name="ConstServerActionReset">
<Type>%Char</Type>
<InitialExpression>"R"</InitialExpression>
</Property>

<Property name="ConstServerActionEcho">
<Type>%Char</Type>
<InitialExpression>"E"</InitialExpression>
</Property>

<Property name="ConstServerActionCheckUpdate">
<Type>%Char</Type>
<InitialExpression>"CU"</InitialExpression>
</Property>

<Property name="ConstServerActionUpdate">
<Type>%Char</Type>
<InitialExpression>"U"</InitialExpression>
</Property>

<Property name="ConstClientPrompt">
<Type>%String</Type>
<InitialExpression>"PROMPT#"</InitialExpression>
</Property>

<Property name="ConstClientStartExec">
<Type>%String</Type>
<InitialExpression>"EST#"</InitialExpression>
</Property>

<Property name="ConstClientEndExec">
<Type>%String</Type>
<InitialExpression>"END#"</InitialExpression>
</Property>

<Property name="ConstClientOutputMessage">
<Type>%String</Type>
<InitialExpression>"O#"</InitialExpression>
</Property>

<Property name="ConstClientOutputLocalized">
<Type>%String</Type>
<InitialExpression>"OL#"</InitialExpression>
</Property>

<Property name="ConstClientChangeNamespace">
<Type>%String</Type>
<InitialExpression>"NS#"</InitialExpression>
</Property>

<Property name="ConstClientLoadAutocomplete">
<Type>%String</Type>
<InitialExpression>"AC#"</InitialExpression>
</Property>

<Property name="ConstClientReadString">
<Type>%String</Type>
<InitialExpression>"R#"</InitialExpression>
</Property>

<Property name="ConstClientReadChar">
<Type>%String</Type>
<InitialExpression>"RC#"</InitialExpression>
</Property>

<Property name="ConstClientAuthorizationStatus">
<Type>%String</Type>
<InitialExpression>"AUTH#"</InitialExpression>
</Property>

<Property name="ConstClientTrace">
<Type>%String</Type>
<InitialExpression>"TRACE#"</InitialExpression>
</Property>

<Property name="ConstClientStopTrace">
<Type>%String</Type>
<InitialExpression>"STOP_TRACE#"</InitialExpression>
</Property>

<Property name="ConstClientLoginInfo">
<Type>%String</Type>
<InitialExpression>"I#"</InitialExpression>
</Property>

<Property name="ConstClientClearScreen">
<Type>%String</Type>
<InitialExpression>"CLRSCR#"</InitialExpression>
</Property>

<Property name="ConstClientPromptUpdate">
<Type>%String</Type>
<InitialExpression>"PROMPT_UPDATE#"</InitialExpression>
</Property>

<UDLText name="T">
<Content><![CDATA[
// CONSTANTS END

]]></Content>
</UDLText>

<Property name="SharedConnection">
<Description><![CDATA[
This property determines whether the communication between the client and WebSocket server should be over a dedicated Gateway
connection or over a pool of shared connections.  It may be set to one of the following:
<br><ul>
<li><b>SharedConnection=0</b> - The WebSocket server communicates with the client via a dedicated Gateway connection. In this mode of operation the hosting connection is effectively 'private' to the application session.</li>
<li><b>SharedConnection=1</b> - The WebSocket server communicates asynchronously with the client via a fixed number of shared Gateway connections.</li>
</ul>]]></Description>
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="CurrentNamespace">
<Type>%String</Type>
</Property>

<Property name="InitialZName">
<Type>%String</Type>
</Property>

<Property name="InitialZNamespace">
<Type>%String</Type>
</Property>

<Property name="Watches">
<Description>
Property is used to store watching files/globals. </Description>
<Type>%List</Type>
</Property>

<Property name="WatchesCaret">
<Description>
Watch position in file on global</Description>
<Type>%Numeric</Type>
<MultiDimensional>1</MultiDimensional>
</Property>

<Method name="redirects">
<Description>
Public point entries, using when redirecting i/o</Description>
<Private>1</Private>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
/// Mnemonics
APC d APC^%X364 q
BEL d BEL^%X364 q
CBT(%1) d CBT^%X364(%1) q
CCH d CCH^%X364 q
CHA(%1) d CHA^%X364(%1) q
CHT(%1) d CHT^%X364(%1) q
CNL(%1) d CNL^%X364(%1) q
CPL(%1) d CPL^%X364(%1) q
CPR d CPR^%X364 q
CTC(%1,%2,%3,%4,%5,%6,%7,%8,%9) d CTC^%X364(%1,%2,%3,%4,%5,%6,%7,%8,%9) q
CUB(%1) d CUB^%X364(%1) q
CUD(%1) d CUD^%X364(%1) q
CUF(%1) d CUF^%X364(%1) q
CUP(%2,%1) d CUP^%X364(%2,%1) q
CUU(%1) d CUU^%X364(%1) q
CVT(%1) d CVT^%X364(%1) q
DA d DA^%X364 q
DAQ(%1,%2,%3,%4,%5,%6,%7,%8,%9) d DAQ^%X364(%1,%2,%3,%4,%5,%6,%7,%8,%9) q
DCH(%1) d DCH^%X364(%1) q
DCS d DCS^%X364 q
DL(%1) d DL^%X364(%1) q
DMI d DMI^%X364 q
DSR(%1) d DSR^%X364(%1) q
EA(%1) d EA^%X364(%1) q
ECH(%1) d ECH^%X364(%1) q
ED(%1) d ED^%X364(%1) q
EF(%1) d EF^%X364(%1) q
EL(%1) d EL^%X364(%1) q
EMI d EMI^%X364 q
EPA d EPA^%X364 q
ESA d ESA^%X364 q
FNT d DNT^%X364 q
GSM d GSM^%X364 q
GSS d GSS^%X364 q
HPA(%1) d HPA^%X364(%1) q
HPR(%1) d HPR^%X364(%1) q
HTJ d HTJ^%X364 q
HTS d HTS^%X364 q
HVP(%1,%2) d HVP^%X364(%1,%2) q
ICH(%1) d ICH^%X364(%1) q
IL(%1) d IL^%X364(%1) q
IND d IND^%X364 q
INT d INT^%X364 q
JFY d JFY^%X364 q
MC d MC^%X364 q
MW d MW^%X364 q
NEL d NEL^%X364 q
NP(%1) d NP^%X364(%1) q
OSC d OSC^%X364 q
PLD d PLD^%X364 q
PLU d PLU^%X364 q
PM d PM^%X364 q
PP(%1) d PP^%X364(%1) q
PU1 d PU1^%X364 q
PU2 d PU2^%X364 q
QUAD d QUAD^%X364 q
REP d REP^%X364 q
RI d RI^%X364 q
RIS d RIS^%X364 q
RM(%1,%2,%3,%4,%5,%6,%7,%8,%9) d RM^%X364(%1,%2,%3,%4,%5,%6,%7,%8,%9) q
SEM d SEM^%X364 q
SGR(%1,%2,%3,%4,%5,%6,%7,%8,%9) d SGR^%X364(%1,%2,%3,%4,%5,%6,%7,%8,%9) q
SL d SL^%X364 q
SM(%1,%2,%3,%4,%5,%6,%7,%8,%9) d SM^%X364(%1,%2,%3,%4,%5,%6,%7,%8,%9) q
SPA d SPA^%X364 q
SPI d SPI^%X364 q
SR d SR^%X364 q
SS2 d SS2^%X364 q
SS3 d SS3^%X364 q
SSA d SSA^%X364 q
ST d ST^%X364 q
STS d STS^%X364 q
SU d SU^%X364 q
TBC d TBC^%X364 q
TSS d TSS^%X364 q
VPA(%1) d VPA^%X364(%1) q
VPR(%1) d VPR^%X364(%1) q
VTS d VTS^%X364 q
    
PrepareOutput(data)
    Try { Set data=$zconvert(data, "O", "UTF8") } Catch {  }
    quit data
    
PrepareInput(data)
    Try { Set data=$zconvert(data, "I", "UTF8") } Catch {  }
    quit data
    
/// Routine from %CSP.WebSocket.cls
ReadMessage(len = 32656, timeout = 86400, BytesAvailable, AtEnd, data, data1, header, size, type)
    Set $ZTrap="ReadError"
    If len<1 Set len=32656
    //If (..SharedConnection = 1) {
    //    Set data=..ReadAsync(.len, .sc, timeout)
    //    Try { Set data1=$zconvert(data,"I","UTF8") } Catch { Set data1=data }
    //    Set len=$Length(data1)
    //    Quit data1
    //}
    Set BytesAvailable=0, AtEnd=0
    Read header#5:timeout
    If $Test=0 {
        Set len=0
        //Set sc=$$$ERROR($$$CSPWebSocketTimeout, "WebSocket Read Operation timed-out")
        Set AtEnd=1
        Quit ""
    }
    Set type=$Extract(header,5)
    If type=9 {
        Set len=0
        //Set sc=$$$ERROR($$$CSPWebSocketClosed,"WebSocket Closed by the Client")
        Set AtEnd=1
        Quit ""
    }
    Set header=$Extract(header, 1, 4)
    Set size=$ZLA(header)-1 If size<0 Set size=0
    Set BytesAvailable=size
ReadData
    If BytesAvailable > len {
        Set size=len
        Set BytesAvailable=BytesAvailable-len
    }
    else {
        Set size=BytesAvailable
        Set BytesAvailable=0
    }
    If 'BytesAvailable Set AtEnd=1
    If size=0 Set len=0 Quit ""
    Read data#size
    Set len=size
    //Set sc=$$$OK
    Try { Set data1=$zconvert(data,"I","UTF8") } Catch { Set data1=data }
    Set len=$Length(data1)
    Quit data1
ReadError   
    #; No interrupts during cleanup or error processing
    $$$SetExternalInterrupts(0)
    Set $ZTrap="ReadHalt"
    Hang 5
    Close 0
ReadHalt
    Halt

/// Workaround for Cache 2015
#define WSProtocol (##class(%Dictionary.CompiledProperty).%OpenId("%CSP.WebSocket||WSClassProtocolVersion"))
WriteMessage(data, data1, head)
    if ($$$WSProtocol) && ($$$WSProtocol.InitialExpression > 1) {
        try { set data1 = $zconvert(data, "O", "UTF8") } catch { set data1 = data }
        set head = $ZLChar($Length(data1))
        set head = head _ "7"
        write head _ data1, *-3
    } else {
        write $$PrepareOutput(data), *-3
    }
    quit
    
//////////////////////////////////////////////

wstr(s)
    do ##class(%Device).ReDirectIO($$$NO)
    do WriteMessage("O#"_s)
    do ##class(%Device).ReDirectIO($$$YES)
    set $X = $X + $LENGTH(s)
    set $Y = $Y - 1
    quit

wchr(c) 
    do ##class(%Device).ReDirectIO($$$NO)
    do WriteMessage("O#"_$c(c))
    do ##class(%Device).ReDirectIO($$$YES)
    set $X = $X + 1
    set $Y = $Y - 1
    quit

wnl 
    do ##class(%Device).ReDirectIO($$$NO)
    do WriteMessage("O#"_$c(13, 10))
    do ##class(%Device).ReDirectIO($$$YES)
    set $X = 0
    quit

wff 
    do ##class(%Device).ReDirectIO($$$NO)
    do WriteMessage("CLRSCR#")
    do ##class(%Device).ReDirectIO($$$YES)
    set $Y = 0
    set $X = 0
    quit
    
wtab(s)
    do ##class(%Device).ReDirectIO($$$NO)
    do WriteMessage("O#" _ $C(27) _ "[" _ (s + 1) _ "G")
    do ##class(%Device).ReDirectIO($$$YES)
    set $X = s
    quit
    
rstr(len = 32656, timeout = 86400, data)
    do ##class(%Device).ReDirectIO($$$NO)
    do WriteMessage("R#" _ len)
    s data = $$ReadMessage(len, timeout)
    do ##class(%Device).ReDirectIO($$$YES)
    quit data
    
rchr(timeout = 86400, data)
    do ##class(%Device).ReDirectIO($$$NO)
    do WriteMessage("RC#")
    set data = $$ReadMessage(, timeout)
    set data = data * 1 // $ASCII($EXTRACT(data,1,1))
    do ##class(%Device).ReDirectIO($$$YES)
    quit data
]]></Implementation>
</Method>

<Method name="OnPreServer">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set ..InitialZName = $zname
    set ..InitialZNamespace = $znspace
    quit $$$OK
]]></Implementation>
</Method>

<Method name="Trace">
<Description>
Chechs for correct watch source and sets watch target to ..Watches
Returns status of this operation</Description>
<FormalSpec>name</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set s = $CHAR(0)
    set watches = s _ $LISTTOSTRING(..Watches, s) _ s
    if ($FIND(watches, s_name_s) '= 0) q 0 // if watch already defined
    
    if ($EXTRACT(name,1,1) = "^") { // watching global
        s g = 0
        try {
            if (($data(@name))'=0) s g = 1
        } catch {  }
        set $ZERROR = ""
        if (g = 1) {
            set ..Watches = ..Watches _ $LISTBUILD(name)
            set ..WatchesCaret(name,0) = $QUERY(@name@(""),-1) // last
            set ..WatchesCaret(name,1) = "?"
            do ..SendData(name, ..ConstClientTrace)
            q 1
        }
    } else { // watch file
        if (##class(%File).Exists(name)) {
            set ..Watches = ..Watches _ $LISTBUILD(name)
            set file = ##class(%File).%New(name)
            set ..WatchesCaret(name,0) = file.Size // current watch cursor position
            set ..WatchesCaret(name,1) = file.DateModified
            do ..SendData(name, ..ConstClientTrace)
            q 1
        }
    }
    
    q 0
]]></Implementation>
</Method>

<Method name="StopTracing">
<Description>
Removes watch from watches list
Returns success status</Description>
<FormalSpec>name</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    // absurdly, but working
    set s = $CHAR(0)
    set watches = s _ $LISTTOSTRING(..Watches,s) _ s
    set newWatches = $REPLACE(watches, s_name_s, s)
    set ..Watches = $LISTFROMSTRING($EXTRACT(newWatches, 2, *-1), s)
    if (watches '= newWatches) {
        k ..WatchesCaret(name) // really removed
        do ..SendData(name, ..ConstClientStopTrace)
    }
    quit watches '= newWatches
]]></Implementation>
</Method>

<Method name="ListWatches">
<Description>
Returns a list current watches</Description>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    set no=0
    set s = "Watching: " _ $CHAR(10)
    while $LISTNEXT(..Watches, no, value) {
        set s = s_"(pos: "_..WatchesCaret(value,0)_
        "; mod: "_..WatchesCaret(value,1)_") "_value_$CHAR(10)
    }
    q s
]]></Implementation>
</Method>

<Method name="GetTraceGlobalModified">
<Description>
Return null string if global hadn't been updated
This method watches only for tail of global and detects if global still alive</Description>
<FormalSpec>watch</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    set data = ""
    if ($data(@watch)=0) {
        do ..StopTracing(watch)
        q "removed"
    }
    for {
        set query = $QUERY(@..WatchesCaret(watch,0))
        quit:query=""
        if (data="") set data = "modified"
        set ..WatchesCaret(watch,0) = query
        set data = data _ $CHAR(13, 10) _ @query
    }
    q data
]]></Implementation>
</Method>

<Method name="GetTraceFileModified">
<FormalSpec>watch</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    set file=##class(%File).%New(watch)
    set size = file.Size
    set modDate = file.DateModified
    set output = ""
    if (size < 0) { // file had been deleted
         
        do ..StopTracing(watch)
        q "removed"
        
    }
    
    if (size > ..WatchesCaret(watch, 0)) {
        
        set output = "updated" _ $CHAR(13, 10)
        set stream=##class(%Stream.FileBinary).%New()
        set sc=stream.LinkToFile(watch)
        do stream.MoveTo(..WatchesCaret(watch, 0) + 1)
        set readed = stream.Read(size - ..WatchesCaret(watch, 0))
        set output=output_readed
        set ..WatchesCaret(watch, 0) = size
        set ..WatchesCaret(watch, 1) = file.DateModified
        
    } elseif ((size < ..WatchesCaret(watch, 0)) || (file.DateModified '= ..WatchesCaret(watch, 1))) {
        
        set output = "modified" _ $CHAR(13, 10)
        set output = output _ "Bytes changed: " _ (size - ..WatchesCaret(watch, 0))
        set ..WatchesCaret(watch, 0) = size
        set ..WatchesCaret(watch, 1) = file.DateModified
        
    } // else file not changed
    q output
]]></Implementation>
</Method>

<Method name="CheckTracing">
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    set no = 0
    set data = ""
    set overal = ""
    set watchList = ..Watches // do not remove or simplify: ..Watches can be modified
    while $LISTNEXT(watchList, no, value) {
        if ($EXTRACT(value, 1, 1) = "^") {
            set data = ..GetTraceGlobalModified(value)
        } else {
            set data = ..GetTraceFileModified(value)
        }
        if (data '= "") {
            set overal = $ZDATETIME($NOW(),1,1) _ " " _
            value _ ": " _ data _ $CHAR(10) 
        }
        set data = ""
    }
    q overal
]]></Implementation>
</Method>

<Method name="OnPostServer">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    kill ^CacheTemp.WebTerminal.Watching
    quit $$$OK
]]></Implementation>
</Method>

<Method name="GetJSAutocompleteFilePath">
<ClassMethod>1</ClassMethod>
<FormalSpec>namespace:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    set data = ##class(%Library.File).ManagerDirectory()
    set data = ##class(%Library.File).ParentDirectoryName(data)
    
    set dataTest = ##class(%Library.File).SubDirectoryName(data, "CSP")
    if (##class(%Library.File).DirectoryExists(dataTest)) {
        set data = ##class(%Library.File).SubDirectoryName(data, "CSP")
    } else {
        set data = ##class(%Library.File).SubDirectoryName(data, "csp")
    }
    
    set data = ##class(%Library.File).SubDirectoryName(data,
        $ZCONVERT($REPLACE("%SYS", "%", ""), "l")
    )
    set data = ##class(%Library.File).SubDirectoryName(data, "webterminal")
    set data = ##class(%Library.File).SubDirectoryName(data, "js")
    set data = ##class(%Library.File).SubDirectoryName(data, "autocomplete")
    set data = ##class(%Library.File).SubDirectoryName(data, namespace _ ".js")
    
    quit data
]]></Implementation>
</Method>

<Method name="WriteToFile">
<ClassMethod>1</ClassMethod>
<FormalSpec>filename:%String,data:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set file=##class(%File).%New(filename)
    do file.Open("WSN")
    do file.WriteLine(data)
    do file.Close()
]]></Implementation>
</Method>

<Method name="getGlobalsJSON">
<ClassMethod>1</ClassMethod>
<FormalSpec>namespace:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[

    set out = "{"
    set rset=##class(%ResultSet).%New("%SYS.GlobalQuery:NameSpaceList")
    set sc=rset.Execute($ZNSPACE,"*",0)
    while (rset.Next()) {
        set out = out _ """" _ $Piece(rset.GetData(1),"(",1) _ """:0,"
    }
    set out = $EXTRACT(out,1,$LENGTH(out)-1) _ "}"
    
    // todo:
    // Set Rset = ##class(%Library.ResultSet).%New("%SYS.GlobalQuery:NameSpaceListChui")
    // s Status=Rset.Execute(NameSpace,Mask,SystemGlobals,.UnavailableDatabases)
    
    q out
]]></Implementation>
</Method>

<Method name="GenerateAutocompleteFile">
<Description>
Generates autocomplete file for namespace. Second parameter decides if
it will be regenerated again. But if namespace equals to "%" - generates
autocomplete file for system classes. Make sure that autocomplete for
system classes generates one time and forever.
@param genSystem - Shows if system classes need to be generated. </Description>
<FormalSpec>namespace:%String,genSystem:%Boolean</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    
    if (genSystem) {
        set filename = ..GetJSAutocompleteFilePath("%")
    } else {
        set filename = ..GetJSAutocompleteFilePath(namespace)
    }
    
    do ..SendData("29", ..ConstClientOutputLocalized)
    do ..SendData(" " _ filename _ $C(13, 10))
    
    if ('##class(%SYS.Namespace).Exists(namespace)) {
        do ..SendData("30", ..ConstClientOutputLocalized)
        do ..SendData(" " _ namespace _ $C(13, 10))
        quit $$$NOTOK
    }
    
    if ('##class(%File).DirectoryExists(##class(%File).GetDirectory(filename))) {
        
        // try to create missed directory
        set result = ##class(%File).CreateDirectoryChain(##class(%File).GetDirectory(filename))
        
        if (result '= 1) {
            do ..SendData("31", ..ConstClientOutputLocalized)
            do ..SendData($C(13, 10))
            quit $$$OK
        }
        
    }

    // get all classes names
    set result = ##class(%ResultSet).%New("%Dictionary.ClassDefinition:Summary")
    do result.Execute()
    
    /*  
    The next COULD BE IMPROVED FOR SPEED, I beleive.
    Generates compressed JSON string of type:
    {
        "class": {
            "%ClassName1": {
                "methodName": 0,
                "propertyName": 0,
                "parameterName": 0,
                ...
            },
            "ClassName2": {
                ...
            }
        },
        "global": {
            "^%g1": 0,
            "^g2": 0
        }
    }
    */
    
    do ..SendData($C(13, 10))
    do ..SendData("32", ..ConstClientOutputLocalized)
    
    set file=##class(%File).%New(filename)
    do file.Open("WSN")
    
    // final data generation
    do file.Write("{""class"":{")
    set first = ""
    set u = 1
    
    while (result.Next()) { // forming autocomplete for each class
    
        if (genSystem) '= ($Extract(result.Data("Name"), 1) = "%") {
            continue
        }
    
        set className = result.Data("Name")
        
        do ..SendData($C(27) _ "[30G" _ u)
        s u = u + 1
        
        do file.Write(first _ """" _ className _ """:{")
        if (first = "") set first = ","
        
        set cdefs = ##class(%Dictionary.ClassDefinition).%OpenId(className)
        
        set countMethods = cdefs.Methods.Count()
        set countParameters = cdefs.Parameters.Count()
        set countProperties = cdefs.Properties.Count()
        set total = countMethods + countParameters + countProperties
        set current = 0
        
        for i=1:1:countMethods {
            set current = current + 1
            do file.Write("""" _ cdefs.Methods.GetAt(i).Name _ """:0")
            if (current'=total) do file.Write(",")
        }
        
        for i=1:1:countProperties {
            set current = current + 1
            do file.Write("""" _ cdefs.Properties.GetAt(i).Name _ """:0")
            if (current'=total) do file.Write(",")
        }
        
        for i=1:1:countParameters {
            set current = current + 1
            do file.Write("""" _ cdefs.Parameters.GetAt(i).Name _ """:0")
            if (current'=total) do file.Write(",")
        }
        
        do file.Write("}")
        
    }
    
    do file.Write("}")
    if ('genSystem) do file.Write(",""global"":" _ ..getGlobalsJSON())
    do file.Write("}")
    do file.Close()
    
    do ..SendData($C(13, 10))
    do ..SendData("33", ..ConstClientOutputLocalized)
    do ..SendData($C(13, 10))
    //do ..SendData(namespace, ..ConstClientLoadAutocomplete)
    
    quit $$$OK
]]></Implementation>
</Method>

<Method name="Reset">
<Description>
Returns terminal to default state</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    // delete autocompletion files
    set dir = ##class(%File).GetDirectory(..GetJSAutocompleteFilePath("TEST"))
    if (##class(%File).DirectoryExists(dir)) {
        do ##class(%File).RemoveDirectoryTree(dir)
    }
    quit $$$OK
]]></Implementation>
</Method>

<Method name="SendData">
<Description>
Function sends data derectly to server with specified action</Description>
<FormalSpec>query:%String="",action:%String=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    if (action = "") { set action = ..ConstClientOutputMessage }
    do ..Write(action _ query)
]]></Implementation>
</Method>

<Method name="ExecuteSQL">
<FormalSpec>query:%String=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    do ..StartClearIO()
    do ##class(%Device).ReDirectIO($$$YES)
    
    set tStatement = ##class(%SQL.Statement).%New()
    set qStatus = tStatement.%Prepare(query)
    if qStatus'=1 {
        write $System.Status.DisplayError(qStatus)
    } else {
        set rset = tStatement.%Execute()
        do rset.%Display()
    }
    
    do ##class(%Device).ReDirectIO($$$NO)
    do ..EndClearIO()
    
    quit $$$OK
]]></Implementation>
</Method>

<Method name="ClientAlertNamespace">
<Description>
Sends to client new namespace if last was changed</Description>
<Implementation><![CDATA[
    if (..CurrentNamespace '= $Znspace) { // change client namespace
        set ..CurrentNamespace = $Znspace
        do ..SendData(..CurrentNamespace,..ConstClientChangeNamespace) 
    }
]]></Implementation>
</Method>

<Method name="StartClearIO">
<Description>
Starts clear I/O mode</Description>
<Implementation><![CDATA[
    write *-3
    do ..Write(..ConstClientStartExec)
    write *-3
    do ##class(%Device).ReDirectIO($$$YES)
]]></Implementation>
</Method>

<Method name="EndClearIO">
<Description>
Ends clear I/O mode</Description>
<Implementation><![CDATA[
    //write *-3
    do ##class(%Device).ReDirectIO($$$NO)
    do ..SendData("",..ConstClientEndExec)
    write *-3
]]></Implementation>
</Method>

<Method name="ParseError">
<Description>
This method transforms error </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>string:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    set string = $REPLACE($REPLACE(string, ">", "<"), ".Engine.", "<")
    quit "ERROR: " _ $PIECE(string, "<", 2) _
        $EXTRACT($PIECE(string, "<", 4), 2, *)
]]></Implementation>
</Method>

<Method name="Update">
<FormalSpec>version</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set httprequest = ##class(%Net.HttpRequest).%New()
    set httprequest.Server = "intersystems-ru.github.io"
    do ..SendData("34", ..ConstClientOutputLocalized)
    do ..SendData("http://intersystems-ru.github.io/webterminal/files/WebTerminal-"
        _ version _ ".xml ")
    do httprequest.Get("/webterminal/files/WebTerminal-" _ version _ ".xml")
    if (httprequest.HttpResponse.StatusCode '= 200) {
        do ..SendData($C(27)_"[31mFAIL" _ $C(27) _ "[0m (status code "
            _ httprequest.HttpResponse.StatusCode _ ")" _ $C(13,10))
        quit $$$NOTOK
    }
    do ..SendData($C(27)_"[32mOK" _ $C(27) _ "[0m")
    if ($isobject(httprequest.HttpResponse.Data)) {
        do ..SendData($C(13,10))
        set data = ""
        set path = ##class(%Library.File).SubDirectoryName(
            ##class(%Library.File).ManagerDirectory(), "temp"
        )
        set filepath = ##class(%Library.File).SubDirectoryName(
            path, "terminal_update.temp.xml"
        )
        do ..SendData("35", ..ConstClientOutputLocalized)
        do ..SendData($C(13, 10))
        set file = ##class(%File).%New(filepath)
        do file.Open("W")
        do file.CopyFrom(httprequest.HttpResponse.Data)
        do file.Close()
        do ..SendData("36", ..ConstClientOutputLocalized)
        do ..SendData($C(13, 10))
        set error = 0
        do ..StartClearIO()
        do $System.OBJ.ImportDir(path, "terminal_update.temp.xml", "ckbud", .error, 1)
        do ..EndClearIO()
        if (error = 0) {
            do ..SendData($C(27)_"[32mOK" _ $C(27) _ "[0m" _ $C(13,10))
        } else {
            do ..SendData($C(27)_"[31mFAIL" _ $C(27) _ "[0m" _ $C(13,10))
        }
        do ..SendData("37", ..ConstClientOutputLocalized)
        if (##class(%Library.File).Delete(filepath) = 1) {
            do ..SendData($C(27)_"[32mOK" _ $C(27) _ "[0m" _ $C(13,10))
        } else {
            do ..SendData($C(27)_"[31mFAIL" _ $C(27) _ "[0m" _ $C(13,10))
            quit $$$NOTOK
        }
    }
    quit $$$OK
]]></Implementation>
</Method>

<Method name="CheckUpdate">
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set httprequest = ##class(%Net.HttpRequest).%New()
    set httprequest.Server = "intersystems-ru.github.io"
    do httprequest.Get("/webterminal/latestVersion")
    if (httprequest.HttpResponse.StatusCode '= 200) {
        do ..SendData($C(27)_"[31mFAIL" _ $C(27) _ "[0m (status code "
            _ httprequest.HttpResponse.StatusCode _ ")" _ $C(13,10))
        quit $$$NOTOK
    }
    if ($isobject(httprequest.HttpResponse.Data)) {
        do ..SendData(httprequest.HttpResponse.Data.Read(), ..ConstClientPromptUpdate)
    }
    quit $$$OK
]]></Implementation>
</Method>

<Method name="ExecuteCommand">
<Description>
The heart of terminal application</Description>
<FormalSpec>query:%String=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    if (query = "") quit $$$OK
    
    #dim exception as %Exception.AbstractException
    set value = $Replace(query, $CHAR(10), " ")
    
    do ..StartClearIO() // execute session start
    
    set $ZERROR = ""
    
    try { xecute value } catch exception {
        set $ZERROR = exception.DisplayString()
    }
    
    if ($ZERROR '= "") {
        w $ZERROR, *-3
    }
    
    do ..EndClearIO() // execute session end
    do ..ClientAlertNamespace() // check namespace change
    
    quit $$$OK
]]></Implementation>
</Method>

<Method name="RequireAuthorization">
<Description>
This method holds process and expects only one package from
the client - it includes authorization key.</Description>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set authKey = ..Read(, .status, ..#authorizationTimeout) // wait for package
    set ok = $$$NOTOK
    
    set namespace = ""
    set pos = $FIND(authKey, "#")
    if pos '= 0 {
        set namespace = $EXTRACT(authKey, pos, *)
        set authKey = $EXTRACT(authKey, 1, pos-2)
    }
    
    /*
     * Find given CSPSessionCookie in session list. If found, grant access.
     */
    SET key = $ORDER(^%cspSession(""))
    WHILE (key '= "") {
        set lb = $GET(^%cspSession(key))
        if (lb '= "") {
            if ($LISTGET(lb, 8) = authKey) {
                
                // setup privileges
                ZNSPACE $LISTGET(lb, 7) // namespace
                
                set user = $LISTGET($LISTGET(lb, 16), 1) // user
                set loginStatus = ##class(%SYSTEM.Security).Login($LISTGET($LISTGET(lb, 16), 1)) // login user
                
                if ($$$ISOK(loginStatus)) { // alert client
                    do ..SendData($SYSTEM _ ":" _ user, ..ConstClientLoginInfo)
                } else {
                    do ..SendData("!", ..ConstClientLoginInfo)
                }
                
                if (namespace '= "") {
                    try {
                        zn namespace
                    } catch (e) { }
                }
                
                set ok = loginStatus
                QUIT
                
            }
        }
        SET key = $ORDER(^%cspSession(key))
    }
    
    quit ok
]]></Implementation>
</Method>

<Method name="ClientLoop">
<Description>
Main method for every new client.</Description>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    
    kill // clear junk vars
    
    do ..SendData($NAMESPACE, ..ConstClientPrompt)
    
    for {
        
        set data = ..Read(,.status)
    
        if $$$ISERR(status) {
       
            try {
                do ..SendData("40", ..ConstClientOutputLocalized)
            } catch e { }
            quit:($$$GETERRORCODE(status)=$$$CSPWebSocketClosed)
            
        }
        
        set pos = $FIND(data, "#")
        set action = $EXTRACT(data, 1, pos-2)
        set data = $EXTRACT(data, pos, *)
            
        if (action = ..ConstServerActionExecute) {
            
            do ..ExecuteCommand(data)
            do ..SendData($NAMESPACE, ..ConstClientPrompt)
                
        } elseif (action = ..ConstServerActionCheckTrace) {
        
            set changes = ..CheckTracing()
            if (changes '= "") {
                do ..SendData(changes)   
            }
          
        } elseif (action = ..ConstServerActionTrace) { // add/remove
        
            set result = ..Trace(data)
            if ('$$$ISOK(result)) {
                set result = ..StopTracing(data)
                if ('$$$ISOK(result)) {
                    do ..SendData("!" _ data, ..ConstClientTrace)
                }
            }
            do ..SendData($NAMESPACE, ..ConstClientPrompt)
          
        } elseif (action = ..ConstServerActionStopTraceAll) { // add/remove
        
            FOR i=1:1:$LISTLENGTH(..Watches) {
                d ..StopTracing($LIST(..Watches, i))
            }
            do ..SendData($NAMESPACE, ..ConstClientPrompt)
          
        } elseif (action = ..ConstServerActionExecuteSQL) { // sql
        
            do ..ExecuteSQL(data)
            do ..SendData($NAMESPACE, ..ConstClientPrompt)
          
        } elseif (action = ..ConstServerActionGenerateAutocomplete) {
            
            // data shows if system classes required
            
            if ('##class("%Library.File").Exists(..GetJSAutocompleteFilePath("%")))
                || (data = "1") {
                do ..GenerateAutocompleteFile("%SYS", 1)
                do ..SendData("%", ..ConstClientLoadAutocomplete)
            }
            do ..GenerateAutocompleteFile(..CurrentNamespace, 0)
            do ..SendData(..CurrentNamespace, ..ConstClientLoadAutocomplete)
                    
        } elseif (action = ..ConstServerActionReset) {
              
            do ..Reset()
            do ..SendData($NAMESPACE, ..ConstClientPrompt)
                    
        } elseif (action = ..ConstServerActionEcho) {
              
            do ..StartClearIO()
            write data
            do ..EndClearIO()
            do ..SendData($NAMESPACE, ..ConstClientPrompt)
                    
        } elseif (action = ..ConstServerActionCheckUpdate) {
            
            do ..CheckUpdate()
            
        } elseif (action = ..ConstServerActionUpdate) {
            
            do ..Update(data)
            do ..SendData("39", ..ConstClientOutputLocalized)
            
        } else { // something scary
                
            do ..SendData("38", ..ConstClientOutputLocalized)
            do ..SendData(" " _ action)
            do ..SendData($NAMESPACE, ..ConstClientPrompt)
                    
        }
            
    }
]]></Implementation>
</Method>

<Method name="Server">
<Description>
New connection established: require auth key, login and start client loop.</Description>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    
    /*UNCOMMENT ON RELEASE!*/
    if ($$$ISOK(..RequireAuthorization())) {
        
        set ..CurrentNamespace = $Znspace
        
        do ..SendData("1", ..ConstClientAuthorizationStatus)
        do ..SendData(..CurrentNamespace, ..ConstClientChangeNamespace)
        
        use $io:(/NOXY:/BREAK):"^" _ ..InitialZName
        do ..ClientLoop()
        
    } else {
        
        do ..SendData("0", ..ConstClientAuthorizationStatus)
        do ..EndServer()
            
    }
    
    quit $$$OK
]]></Implementation>
</Method>
</Class>


<CSP name="webterminal/css/base.css" application="/csp/sys/" default="1"><![CDATA[
html, body {
    position: relative;
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    overflow: hidden;
}]]></CSP>


<CSP name="webterminal/css/terminal-theme-cache.css" application="/csp/sys/" default="1"><![CDATA[
.terminalContainer {
    color: black;
    background: white;

    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.terminalContainer .terminalHint {
    text-shadow: 1px 1px 4px white;
}

.term-gri31 {
    color: #c80000;
}

.term-gri32 {
    color: #00c800;
}

.term-gri33 {
    color: #c8c800;
}

.term-gri34 {
    color: #0000c8;
}

.term-gri35 {
    color: #c800c8;
}

.term-gri36 {
    color: #00c8c8;
}

.term-gri41 {
    background-color: #c80000;
}

.term-gri42 {
    background-color: #00c800;
}

.term-gri43 {
    background-color: #c8c800;
}

.term-gri44 {
    background-color: #0000c8;
}

.term-gri45 {
    background-color: #c800c8;
}

.term-gri46 {
    background-color: #00c8c8;
}

]]></CSP>


<CSP name="webterminal/css/terminal.css" application="/csp/sys/" default="1"><![CDATA[
.terminalContainer {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    color: white;
    background: black;
    font-family: FreeMono, monospace;
    font-size: 16px;

    -webkit-font-smoothing: subpixel-antialiased;
    -moz-osx-font-smoothing: auto;
}

.terminalContainer .terminalOutputCentralizer {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    display: table;
}

.terminalContainer .terminalOutputCentralizer > div {
    display: table-cell;
    text-align: center;
    vertical-align: middle;
}

.terminalContainer .terminalOutputCentralizer > div > div {
    display: inline-block;
    text-align: left;
    position: relative;
    overflow-y: scroll;
}

.terminalContainer .terminalInput {
    width: 100%;
    margin: 0;
    padding: 0;
    opacity: 0;

    /* ie visible caret fix (except one annoying pixel, huh) */
    position: absolute;
    height: 1em;
    top: -1.5em;
}

.terminalContainer .terminalOutput {
    white-space: pre;
    word-wrap: break-word;
    word-break: break-all;
    overflow-x: hidden;
}

.terminalContainer .terminalOutput > div {
    position: relative;
    overflow: hidden;
}

.terminalContainer .terminalCaret {
    position: absolute !important;
    left: 0;
    top: 0;
    animation: blink infinite 1s;
    -o-animation: blink infinite 1s;
    -ms-animation: blink infinite 1s;
    -moz-animation: blink infinite 1s;
    -webkit-animation: blink infinite 1s;
}

.terminalContainer .terminalCaret:after {
    position: relative;
    top: -1px;
    content: "_";
}

.terminalContainer .terminalHint {
    position: absolute !important;
    left: 0;
    top: 0;
    color: inherit;
    opacity: 0.6;
    text-shadow: 1px 1px 4px black;
    z-index: 10;
}

.terminalContainer .terminalIndicator {
    position: absolute !important;
    right: -7px;
    top: 7px;
    border: 3px solid #fff;
    border-radius: 30px;
    height: 30px;
    margin: -15px 0 0 -15px;
    opacity: 0;
    width: 30px;
    animation: pulsate infinite 1s;
    -o-animation: pulsate infinite 1s;
    -ms-animation: pulsate infinite 1s;
    -moz-animation: pulsate infinite 1s;
    -webkit-animation: pulsate infinite 1s;
}
@-webkit-keyframes blink {
    0% { opacity: 1.0; }
    50% { opacity: 0.0; }
    100% { opacity: 1.0; }
}

@-o-keyframes blink {
    0% { opacity: 1.0; }
    50% { opacity: 0.0; }
    100% { opacity: 1.0; }
}

@-moz-keyframes blink {
    0% { opacity: 1.0; }
    50% { opacity: 0.0; }
    100% { opacity: 1.0; }
}

@-ms-keyframes blink {
    0% { opacity: 1.0; }
    50% { opacity: 0.0; }
    100% { opacity: 1.0; }
}

@keyframes blink {
    0% { opacity: 1.0; }
    50% { opacity: 0.0; }
    100% { opacity: 1.0; }
}

@-ms-keyframes pulsate {
    0% {
        transform: scale(.1);
        -o-transform: scale(.1);
        -ms-transform: scale(.1);
        -moz-transform: scale(.1);
        -webkit-transform: scale(.1);
        opacity: 0.0;
    }
    50% { opacity:1; }
    100% {
        transform: scale(.5);
        -o-transform: scale(.5);
        -ms-transform: scale(.5);
        -moz-transform: scale(.5);
        -webkit-transform: scale(.5);
        opacity:0;
    }
}

@-moz-keyframes pulsate {
    0% {
        transform: scale(.1);
        -o-transform: scale(.1);
        -ms-transform: scale(.1);
        -moz-transform: scale(.1);
        -webkit-transform: scale(.1);
        opacity: 0.0;
    }
    50% { opacity:1; }
    100% {
        transform: scale(.5);
        -o-transform: scale(.5);
        -ms-transform: scale(.5);
        -moz-transform: scale(.5);
        -webkit-transform: scale(.5);
        opacity:0;
    }
}

@-o-keyframes pulsate {
    0% {
        transform: scale(.1);
        -o-transform: scale(.1);
        -ms-transform: scale(.1);
        -moz-transform: scale(.1);
        -webkit-transform: scale(.1);
        opacity: 0.0;
    }
    50% { opacity:1; }
    100% {
        transform: scale(.5);
        -o-transform: scale(.5);
        -ms-transform: scale(.5);
        -moz-transform: scale(.5);
        -webkit-transform: scale(.5);
        opacity:0;
    }
}

@-webkit-keyframes pulsate {
    0% {
        transform: scale(.1);
        -o-transform: scale(.1);
        -ms-transform: scale(.1);
        -moz-transform: scale(.1);
        -webkit-transform: scale(.1);
        opacity: 0.0;
    }
    50% { opacity:1; }
    100% {
        transform: scale(.5);
        -o-transform: scale(.5);
        -ms-transform: scale(.5);
        -moz-transform: scale(.5);
        -webkit-transform: scale(.5);
        opacity:0;
    }
}

@keyframes pulsate {
    0% {
        transform: scale(.1);
        -o-transform: scale(.1);
        -ms-transform: scale(.1);
        -moz-transform: scale(.1);
        -webkit-transform: scale(.1);
        opacity: 0.0;
    }
    50% { opacity:1; }
    100% {
        transform: scale(.5);
        -o-transform: scale(.5);
        -ms-transform: scale(.5);
        -moz-transform: scale(.5);
        -webkit-transform: scale(.5);
        opacity:0;
    }
}
.term-gri1 { /* bright */
    font-weight: 900;
}

.term-gri2 { /* dim */
    opacity: 0.8;
}

.term-gri3 {
    font-style: italic;
}

.term-gri4 {
    text-decoration: underline;
}

.term-gri5 {
    animation: blink infinite 1s;
    -o-animation: blink infinite 1s;
    -ms-animation: blink infinite 1s;
    -moz-animation: blink infinite 1s;
    -webkit-animation: blink infinite 1s;
}

.term-gri7 {
    -webkit-filter: invert(100%);
    filter: invert(100%);
}

.term-gri8 {
    opacity: 0;
}

.term-gri30 {
    color: #000000;
}

.term-gri31 {
    color: #ff0000;
}

.term-gri32 {
    color: #008000;
}

.term-gri33 {
    color: yellow;
}

.term-gri34 {
    color: #0000ff;
}

.term-gri35 {
    color: magenta;
}

.term-gri36 {
    color: cyan;
}

.term-gri37 {
    color: white;
}

.term-gri40 {
    background-color: #000000;
}

.term-gri41 {
    background-color: #ff0000;
}

.term-gri42 {
    background-color: #008000;
}

.term-gri43 {
    background-color: yellow;
}

.term-gri44 {
    background-color: #0000ff;
}

.term-gri45 {
    background-color: magenta;
}

.term-gri46 {
    background-color: cyan;
}

.term-gri47 {
    background-color: white;
}]]></CSP>


<CSPBase64 name="webterminal/favicon.ico" application="/csp/sys/" default="1">
AAABAAEAEBAAAAAAAABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAA
AAAAAAD///8BAAAABQAAABEAAAAJAAAAAwAAAAMAAAAD////Af///wH///8B////Af///wH///8B
////Af///wH///8B////AQAAAAcAAAAVLyoiXzcxJa09NijfPjcp4YiHhcWbm5ypioqLhWtrbF8v
Ly85AAAAIQAAAAP///8B////AXt7fBGFhYZHiomLRXFua0FEPzNPOjMkY1dSSceqqqr/vLy9/7a2
t/+vr7D/kZGS4wAAABkAAAAbAAAAFf///wGXlZKPq6qg57GtlK2vqIqjsaySt6+qlcOvr5/1t7es
/76+t//GxsT/zMzM98fIyIW8vLxDwcHBKY6Njg////8BioZ8j5aTjpkUERGjHRIS4SIVFM8oGRa9
Mh8ZrUc0KatfTT2tdWROsYZ1XauciHGVt6aQl7uwnp/GxLPRuLi2gYyIfo+XlJCZCQgIzQAAAP8A
AAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8IBgX/Eg8O5bOwpXuOi4CPmZaSmQgI
B80AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wICAfGqqKB3kY2C
j5yZlJkIBwfNAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8FBATt
paKcd5SQhY+em5eZCAcHzQAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wUFBf8a
Ghr/Li0s65+dl3WXk4iPop+amQgHB80AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AQEB/xIS
Ev8mJib/MjIy/zk3NumamJJ1m5eMj6WinZkHBwfPXV1d/wcHB/9PT0//V1dX/0tLS/8AAAD/BQUF
/xkZGf8nJyf/MjIy/zw8PP9CPz3nlJKNdZ+bj5GopZ+ZBwcHz25ubv+qqqr/ODg4/zg4OP8pKSn/
CAgI/xwcHP8oKCj/MzMz/zw8PP9DQ0P/SENB55COiXOin5KRq6iimQcHBs9gYGD/m5ub/wAAAP8A
AAD/DQ0N/x0dHf8oKCj/MzMz/z09Pf9DQ0P/R0dH/0pFQ+WMioVzpaGUkaunoZ8ICAjPc3Nz/wcH
B/0GBgb1FBMT7x4eHecqKSfhNTMx3T89OttIRUHZT0xH2VVSTNtwbWTflZOQibKwrYe4tanplpGC
s4uDcamblIOto52Ot6Gcj7+fmo69nZmNs5qWi6mVkombjoyFjYaFgH9/f3xxfXx9Y3t8fi+npqYb
sbKyU7m4uE2/v787srKxKY+OjxdtbW0H////Af///wH///8B////Af///wH///8B////Af///wH/
//8B//8AAPA/AAD8DwAAAA8AAAAAAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAA
AAAADwAA//8AAA==
</CSPBase64>


<CSP name="webterminal/index.CSP" application="/csp/sys/" default="1"><![CDATA[
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8"/>
    <title>Cach&eacute; WEB Terminal</title>
    <meta name="author" content="ZitRo"/>
    <meta name="description" content="Web-based terminal emulator for Cach? administering."/>
    <meta name="keywords" content="Cache,Cach?,terminal,web,remote,control,Cach? WebTerminal"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <meta name="MobileOptimized" content="320"/>
    <meta name="HandheldFriendly" content="true"/>
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <link href="favicon.ico" rel="shortcut icon" type="image/x-icon"/>

    <link rel="stylesheet" href="css/base.css"/>
    <link rel="stylesheet" href="css/terminal.css"/>
    <script type="text/javascript" src="js/terminal.js"></script>
</head>
<body onload="this.terminal = createTerminal('#(%session.CSPSessionCookie)#','#(%request.Get("NS"))#'); document.body.removeAttribute('onload');">

</body>
</html>]]></CSP>


<CSP name="webterminal/js/terminal.js" application="/csp/sys/" default="1"><![CDATA[
!function(a,b){b.terminal=a;var c=function(a){this.CONTROLLER=a,this._lc=a.TERMINAL.localization,this.SYSTEM_CLASSES_LOADED=!1,this.initialize()};c.prototype.STORAGE_NAME="cacheAutocomplete",c.prototype.initialize=function(){var a,b=this.CONTROLLER.TERMINAL.storage.get(this.STORAGE_NAME),c=this;b&&this.CONTROLLER.TERMINAL.execReady(this,function(){if(c.CONTROLLER.TERMINAL.settings.AUTOCOMPLETE){try{b=JSON.parse(b)}catch(d){return void console.error(d)}c.CONTROLLER.TERMINAL.output.print(c._lc.get(52)+" "),c.CONTROLLER.TERMINAL.output.getCurrentLine().render();for(a in b)c.registerObject(a,b[a]);c.CONTROLLER.TERMINAL.output.print(c._lc.get(53)+"\r\n")}})},c.prototype.registerObject=function(a,b){var c,d,e,f=this.CONTROLLER.TERMINAL.storage.get(this.STORAGE_NAME)||"{}";for(c in b["class"]){this.CONTROLLER.TERMINAL.autocomplete.register(this.CONTROLLER.TERMINAL.autocomplete.TYPES["class"],c,"%"===a?void 0:a);for(e in b["class"][c])this.CONTROLLER.TERMINAL.autocomplete.register(this.CONTROLLER.TERMINAL.autocomplete.TYPES.subclass,e,"%"===a?void 0:a,[c])}for(d in b.global)this.CONTROLLER.TERMINAL.autocomplete.register(this.CONTROLLER.TERMINAL.autocomplete.TYPES.globals,d,"%"===a?void 0:a);if("%"===a&&(this.SYSTEM_CLASSES_LOADED=!0),f)try{f=JSON.parse(f),f[a]=b,this.CONTROLLER.TERMINAL.storage.set(this.STORAGE_NAME,JSON.stringify(f))}catch(g){console.error(g)}};var d=function(a){this._lc=a.TERMINAL.localization,this.CONTROLLER=a,this._trace={},this._interval=0,this.TRACING_INTERVAL=1e3};d.prototype._timeout=function(){this.CONTROLLER.EXECUTION_IN_PROGRESS||this.CONTROLLER.server.send(this.CONTROLLER.SERVER_ACTION.CHECK_TRACE)},d.prototype.start=function(a){var b=this;return"!"===a.charAt(0)?void this.CONTROLLER.TERMINAL.output.print(this._lc.get(5,a.substr(1))):(this._interval||(this._interval=setInterval(function(){b._timeout.call(b)},b.TRACING_INTERVAL)),this._trace[a]=!0,void this.CONTROLLER.TERMINAL.output.print(this._lc.get(7,a)))},d.prototype.stop=function(a){var b=!0;if(a)delete this._trace[a],this.CONTROLLER.TERMINAL.output.print(this._lc.get(8,a));else for(b in this._trace)this.CONTROLLER.server.send(this.CONTROLLER.SERVER_ACTION.TRACE+b);for(b in this._trace){b=!1;break}b&&(clearInterval(this._interval),this._interval=0)};var e=function(a,b,c,d){this._lc=a.TERMINAL.localization,this.CACHE_CLASS_NAME="%WebTerminal.Engine.cls",this.PROTOCOL=b,this.IP=c,this.PORT=d,this.CONTROLLER=a,this.socket=null,this.initialize()};e.prototype.RECONNECTION_TIMEOUT=1e4,e.prototype.initialize=function(){var a=this;try{this.socket=new WebSocket(this.PROTOCOL+"//"+this.IP+(this.PORT?":"+this.PORT:"")+"/"+encodeURIComponent(this.CACHE_CLASS_NAME))}catch(b){this.onError(),console.error(b)}this.socket.onopen=function(b){a.onConnect.call(a,b)},this.socket.onclose=function(b){a.onClose(b)},this.socket.onerror=function(){a.onError()},this.socket.onmessage=function(b){a.CONTROLLER.serverData(b.data)}},e.prototype.getAutocompleteFile=function(a,b){f.get("js/autocomplete/"+encodeURIComponent(a)+".js",function(c){try{c=JSON.parse(c)}catch(d){c=null,console.warn("No autocomplete data for "+a)}b(c,a)})},e.prototype.send=function(a){try{this.socket.send(a)}catch(b){this.CONTROLLER.TERMINAL.output.print(this._lc.get(3)+"\r\n"),console.error(b)}},e.prototype.onConnect=function(){var a,b;this.CONTROLLER.TERMINAL.output.print(this._lc.get(2)+"\r\n"),(a=this.CONTROLLER.TERMINAL.SETUP.authKey)&&this.send(a+((b=this.CONTROLLER.TERMINAL.SETUP.defaultNamespace)?"#"+b:""))},e.prototype.onClose=function(a){this.CONTROLLER.TERMINAL.output.print(this._lc.get(4,a.code,a.reason)+"\r\n")},e.prototype.onError=function(){var a=this;this.CONTROLLER.TERMINAL.output.print(this._lc.get(6,this.socket.url,this.RECONNECTION_TIMEOUT/1e3)+"\r\n"),setTimeout(function(){a.initialize()},this.RECONNECTION_TIMEOUT)},String.prototype.splice=function(a,b,c){return this.slice(0,a)+c+this.slice(a+Math.abs(b))};var f=new function(){this.get=function(a,b,c){var d,e=new XMLHttpRequest;c="cache="+(c?1:Math.random()),e.onreadystatechange=function(){4===e.readyState&&(200===e.status?b.call(window,e.responseText,!1):b.call(window,"",!0))},d=-1===a.indexOf("?")?"?":"&";try{e.open("GET",a+d+c,!0),e.send()}catch(f){}}};this.createTerminal=function(a,b){var c;return c=new g({container:document.body,authKey:a||null,defaultNamespace:b}),window.addEventListener("keydown",function(a){a.ctrlKey||a.shiftKey||a.altKey||c.elements.input===document.activeElement||c.input.focus()}),c};var g=function(a){this.VERSION="".concat("2.0.0-beta.6")||"*-dev",this.RELEASE_NUMBER=parseInt("".concat(8))||0,this._execReady=[],this.storage=new x,this.localization=new s(this),this.dictionary=new o,this.settings=new w(this),this.autocomplete=new h,this.SETUP={defaultNamespace:a.defaultNamespace||"",controller:a.controller||new i(this),container:a.container||document.body,authKey:a.authKey||null},this.elements=new k(this.SETUP.container),this.progressIndicator=new n(this),this.theme=new y(this),this.parser=new v(this),this.output=new t(this),this.input=new p(this),this.favorites=new l(this),this.definitions=new j(this),this.controller=this.SETUP.controller,this.initialize()
};g.prototype.initialize=function(){var a;for(a in this.controller.internalCommands)this.autocomplete.register(this.autocomplete.TYPES.keyword,"/"+a);for(a in this.dictionary.KEYWORDS)a.length<2||(this.autocomplete.register(this.autocomplete.TYPES.keyword,a),this.autocomplete.register(this.autocomplete.TYPES.keyword,a.toUpperCase()));for(a=0;a<this._execReady.length;a++)this._execReady[a]["function"].apply(this._execReady[a]["this"],this._execReady[a].args)},g.prototype.execReady=function(a,b,c){this._execReady.push({"function":b,"this":a,args:c})},g.prototype.reset=function(){var a=this;this.output.printSync(this.localization.get(9)+"\r\n"),window.addEventListener("beforeunload",function(){a.storage.clear()})};var h=function(){this._trie={},this._namespaceTries={},this.NAMESPACE=""};h.prototype.TYPES={common:{regExp:/([a-zA-Z][a-z0-9A-Z]*)$/},keyword:{regExp:/([\$#\/]*[a-zA-Z]*[a-z0-9A-Z]*)$/i},"class":{regExp:/##class\((%?[a-zA-Z]*[a-zA-Z0-9\.]*)$/,priority:1,split:"."},subclass:{regExp:/##class\((%?[a-zA-Z]*[a-zA-Z0-9\.]*)\)\.(%?[a-zA-Z]*[a-zA-Z0-9]*)$/,priority:2},globals:{regExp:/\^(%?[a-z0-9A-Z]*)/}},h.prototype.setNamespace=function(a){this.NAMESPACE=a},h.prototype._appendEndings=function(a,b,c){var d,e=function(b,c){a[b]=c},f=function(a,b){for(d in a)d===c.split&&""!==b?e(b,0):"\n"===d?""!==b&&a[d].type===c&&e(b,0):"type"!==d&&f(a[d],b+d)},g=function(a){for(d=0;d<b.length;d++)if(a=a[b[d]],!a)return;f(a,"")};g(this._trie),g(this._namespaceTries[this.NAMESPACE]||{})},h.prototype.getEndings=function(a){var b,c,d,e={},f=[],g=0,h=60;if((a.match(/"/g)||[]).length%2===1)return[];a=a.substr(Math.max(a.length-h,0),Math.min(h,a.length));for(b in this.TYPES)c=this.TYPES[b].regExp||this.TYPES.common.regExp,d=(a.match(c)||[]).slice(1).join("\n"),d&&(this.TYPES[b].priority>g?(e={},g=this.TYPES[b].priority,this._appendEndings(e,d,this.TYPES[b])):(this.TYPES[b].priority||0)===g&&this._appendEndings(e,d,this.TYPES[b]));for(b in e)f.push(b);return f.sort(function(a,b){return e[a]-e[b]}),f},h.prototype.register=function(a,b,c,d){var e,f=c?this._namespaceTries[c]||(this._namespaceTries[c]={}):this._trie;for(d&&(b=(d||[]).join("\n")+"\n"+b),e=0;e<b.length;e++)f=f.hasOwnProperty(b[e])?f[b[e]]:f[b[e]]={};f["\n"]={type:a}};var i=function(a){this.TERMINAL=a,this._lc=a.localization,this.EXECUTION_IN_PROGRESS=!1,this.server=new e(this,"https:"===location.protocol?"wss:":"ws:",location.hostname,"".concat(location.port||80)||"57772"),this.trace=new d(this),this.autocompleteController=new c(this),this.NAMESPACE="UNAUTHORIZED",this._mode=this.MODE.UNAUTHORIZED};i.prototype.MODE={UNAUTHORIZED:0,EXECUTE:1,CLEAR_IO:2,SQL:3,MACRO:4},i.prototype.SERVER_ACTION={EXECUTE:"EXEC#",EXECUTE_SQL:"SQL#",AUTOCOMPLETE:"AC#",TRACE:"TRACE#",STOP_TRACE_ALL:"STOP_TRACE_ALL#",CHECK_TRACE:"CT#",RESET:"R#",ECHO:"E#",CHECK_UPDATE:"CU#",UPDATE:"U#"},i.prototype.authorized=function(){this._mode=this.MODE.EXECUTE,this.TERMINAL.output.printSync(this._lc.get(10)+"\r\n")},i.prototype.setNamespace=function(a){this.TERMINAL.autocomplete.setNamespace(a),this.NAMESPACE=a},i.prototype.internalCommands={help:function(){this.TERMINAL.output.print(this.TERMINAL.localization.get(1))},autocomplete:function(a){return this.TERMINAL.settings.AUTOCOMPLETE?(this.server.send(this.SERVER_ACTION.AUTOCOMPLETE+(this.autocompleteController.SYSTEM_CLASSES_LOADED&&"sys"!==a[0]?"0":"1")),!1):void this.TERMINAL.output.print(this._lc.get(50)+"\r\n")},echo:function(a){return this.server.send(this.SERVER_ACTION.ECHO+a.join("\r\n")),!1},trace:function(a){return this.server.send(a[0]?this.SERVER_ACTION.TRACE+a[0]:this.SERVER_ACTION.STOP_TRACE_ALL),!1},sql:function(){this._mode=this._mode===this.MODE.SQL?this.MODE.EXECUTE:this.MODE.SQL},reset:function(){return this.TERMINAL.reset(),!1},favorite:function(a){var b,c=this;a.length?a[1]?this.TERMINAL.favorites.set(a[1],a[0]):(b=this.TERMINAL.favorites.get(a[0]),b?setTimeout(function(){c.TERMINAL.input.set(b)},1):this.TERMINAL.output.print(this._lc.get(12,a[0],this.TERMINAL.favorites.getList().join(", "))+"\r\n")):this.TERMINAL.output.print(this._lc.get(11,this.TERMINAL.favorites.getList().join(", "))+"\r\n")},define:function(a){a[0]&&a[1]&&"clear"!==a[0]?(this.TERMINAL.definitions.define(a[1],a[0]),this.TERMINAL.output.print(this._lc.get(13,a[0],a[1]))):"clear"===a[0]?(this.TERMINAL.definitions.clear(),this.TERMINAL.output.print(this._lc.get(14)+"\r\n")):this.TERMINAL.output.print(this._lc.get(15,this.TERMINAL.definitions.getList().join(", ")))},version:function(){this.TERMINAL.output.print(this.TERMINAL.VERSION+"\r\n")},update:function(){return this.TERMINAL.output.print(this._lc.get(16,this.TERMINAL.VERSION)+"\r\n"),this.server.send(this.SERVER_ACTION.CHECK_UPDATE),!1},settings:function(a){var b,c,d,e,f=this;(b=a.join("")).match(/[a-z]=[a-z0-9]/)?(c=b.substring(0,b.indexOf("=")),d=b.substr(c.length+1),e={locale:function(a){f.TERMINAL.output.print(f.TERMINAL.localization.setLocale(a)?f._lc.get(27,a)+"\r\n":f._lc.get(28,a)+"\r\n")},theme:function(a){f.TERMINAL.output.print(f.TERMINAL.theme.setTheme(a)?f._lc.get(41,a)+"\r\n":f._lc.get(42,a)+"\r\n")
},highlightInput:function(a){f.TERMINAL.output.print(f.TERMINAL.settings.setHighlightInput("true"===a.toLowerCase())?f._lc.get(44)+"\r\n":f._lc.get(45)+"\r\n")},showProgressIndicator:function(a){f.TERMINAL.output.print(f.TERMINAL.settings.setShowProgressIndicator("true"===a.toLowerCase())?f._lc.get(46)+"\r\n":f._lc.get(47)+"\r\n")},autocomplete:function(a){f.TERMINAL.settings.setAutocomplete("true"===a.toLowerCase())?f.TERMINAL.output.print(f._lc.get(48)+"\r\n"):(f.TERMINAL.input.clearAutocompleteVariants(),f.TERMINAL.output.print(f._lc.get(49)+"\r\n"))}}[c],e?e(d):this.TERMINAL.output.print(this._lc.get(51,c)+"\r\n")):this.TERMINAL.output.print(this._lc.get(26,"locale",this.TERMINAL.localization.getLocale(),this.TERMINAL.localization.getAvailableList().join(", "),"theme",this.TERMINAL.theme.getCurrentTheme(),this.TERMINAL.theme.getAvailableList().join(", "),"highlightInput",this.TERMINAL.settings.HIGHLIGHT_INPUT,"showProgressIndicator",this.TERMINAL.settings.SHOW_PROGRESS_INDICATOR,"autocomplete",this.TERMINAL.settings.AUTOCOMPLETE)+"\r\n")},about:function(){var a,b=this._lc.get(43),c=0,d=this,e=function(){c<b.length?(d.TERMINAL.output.print(b[c]),c++):(clearInterval(a),d.clientAction.PROMPT.call(d,d.NAMESPACE))};return a=setInterval(e,25),!1}},i.prototype.internalCommand=function(a){var b,c,d,e=a.match(/^\/([a-z]+)|\s\/([a-z]+)/),f=[];return e?((d=e[1])?c=a.substr(e[0].length):(d=e[2])&&(f.push(a.substr(0,a.indexOf(e[0]))),c=a.substr(a.indexOf(e[0])+e[0].length)),b=c.match(/"([^"]*)"|([^\s]*)/g),b.filter(function(a,b,c){'"'===a.charAt(0)&&(c[b]=a.substr(1,a.length-2)),a&&f.push(c[b])}),this.internalCommands.hasOwnProperty(d)?this.internalCommands[d].call(this,f)===!1?-1:!0:!1):!1},i.prototype.terminalQuery=function(a){var b;this.EXECUTION_IN_PROGRESS?this.server.send(a):(this.TERMINAL.output.print("\r\n"),b=this.internalCommand(a),-1===b||(b?this.clientAction.PROMPT.call(this,this.NAMESPACE):this._mode===this.MODE.SQL?this.server.send(this.SERVER_ACTION.EXECUTE_SQL+a):this._mode===this.MODE.EXECUTE?this.server.send(this.SERVER_ACTION.EXECUTE+a):console.warn("Unimplemented in mode "+this._mode+": ",a)))},i.prototype.mergeAutocompleteFile=function(a){var b=this;b.TERMINAL.output.printSync(this._lc.get(18,a)+"\r\n"),this.server.getAutocompleteFile(a,function(a,c){a?(b.autocompleteController.registerObject(c,a),b.clientAction.PROMPT.call(b,b.NAMESPACE)):(b.TERMINAL.output.print(b._lc.get(21)+"\r\n"),b.clientAction.PROMPT.call(b,b.NAMESPACE))})},i.prototype.clientAction={PROMPT:function(a){this.setNamespace(a),this.TERMINAL.output.print("\r\n"),this.TERMINAL.input.prompt(a+(this._mode===this.MODE.SQL?":SQL":"")+" > ")},EST:function(){this.EXECUTION_IN_PROGRESS=!0},END:function(){this.EXECUTION_IN_PROGRESS=!1},O:function(a){this.TERMINAL.output.print(a)},OL:function(a){this.TERMINAL.output.print(this._lc.get(a))},NS:function(a){this.setNamespace(a)},AC:function(a){this.mergeAutocompleteFile(a)},R:function(a){this.TERMINAL.input.prompt("",a)},RC:function(){var a=this;this.TERMINAL.input.getChar(function(b){a.server.send(b)})},AUTH:function(a){"1"===a?this.authorized():this.TERMINAL.output.printSync(this._lc.get(22)+"\r\n")},TRACE:function(a){this.trace.start(a)},STOP_TRACE:function(a){this.trace.stop(a)},I:function(a){this.TERMINAL.output.print(a+"\r\n")},CLRSCR:function(){this.TERMINAL.output.clear()},PROMPT_UPDATE:function(a){var b,c=this,d=a.split("#");return b=d[1],d=parseInt(d[0]),b&&d?void(d>this.TERMINAL.RELEASE_NUMBER?(this.TERMINAL.output.print(this._lc.get(23)+"\r\n"),this.TERMINAL.input.prompt("",1,function(a){"y"===a.toLowerCase()?(c.TERMINAL.output.print(" "+c._lc.get(24)+"\r\n"),c.server.send(c.SERVER_ACTION.UPDATE+b)):c.clientAction.PROMPT.call(c,c.NAMESPACE)})):(this.TERMINAL.output.print(this._lc.get(25)+"\r\n"),this.clientAction.PROMPT.call(this,this.NAMESPACE))):void console.error("Unable to parse version data: ",a)}},i.prototype.serverData=function(a){var b=a.split("#",1)[0],c=a.substr(b.length+1);this.clientAction.hasOwnProperty(b)?this.clientAction[b].call(this,c):(this.TERMINAL.output.print(a),console.error("Server response unrecognised:",a))};var j=function(a){this.TERMINAL=a,this._storage={},this.initialize()};j.prototype.STORAGE_NAME="terminal-definitions",j.prototype.initialize=function(){var a=this,b=this.TERMINAL.storage.get(this.STORAGE_NAME);window.addEventListener("beforeunload",function(){a.TERMINAL.storage.set(a.STORAGE_NAME,a.exportJSON())}),b&&this.importJSON(b)},j.prototype.define=function(a,b){this._storage[a]=b},j.prototype.clear=function(){this._storage={}},j.prototype.getList=function(){var a,b=[];for(a in this._storage)b.push(a);return b},j.prototype.replace=function(a){var b;for(b in this._storage)a=a.replace(b,this._storage[b]);return a},j.prototype.importJSON=function(a){var b,c;try{b=JSON.parse(a);for(c in this)this.hasOwnProperty(c)&&(this[c]=b[c]||this[c])}catch(d){console.error(d)}},j.prototype.exportJSON=function(){return JSON.stringify({_storage:this._storage})};
var k=function(a){this.terminal=document.createElement("div"),this.output=document.createElement("div"),this.input=document.createElement("input"),this.themeLink=document.createElement("link"),this._initialize(a)};k.prototype._initialize=function(a){var b=document.createElement("div"),c=document.createElement("div");this.terminal.className="terminalContainer",b.className="terminalOutputCentralizer",this.input.className="terminalInput",this.output.className="terminalOutput",this.terminal.appendChild(this.input),c.appendChild(this.output),b.appendChild(c),this.terminal.appendChild(b),a.appendChild(this.terminal),this.themeLink.id="terminal-theme",this.themeLink.setAttribute("rel","stylesheet"),this.terminal.appendChild(this.themeLink)};var l=function(a){this.TERMINAL=a,this._storage={},this.initialize()};l.prototype.STORAGE_NAME="terminal-favorites",l.prototype.initialize=function(){var a=this,b=this.TERMINAL.storage.get(this.STORAGE_NAME);window.addEventListener("beforeunload",function(){a.TERMINAL.storage.set(a.STORAGE_NAME,a.exportJSON())}),b&&this.importJSON(b)},l.prototype.set=function(a,b){this._storage[a]=b},l.prototype.get=function(a){return this._storage[a]||""},l.prototype.getList=function(){var a,b=[];for(a in this._storage)b.push(a);return b},l.prototype.importJSON=function(a){var b,c;try{b=JSON.parse(a);for(c in this)this.hasOwnProperty(c)&&(this[c]=b[c]||this[c])}catch(d){console.error(d)}},l.prototype.exportJSON=function(){return JSON.stringify({_storage:this._storage})};var m=function(a){this.TERMINAL=a,this.element=document.createElement("div"),this.initialize()};m.prototype.initialize=function(){this.element.className="terminalHint"},m.prototype.show=function(a,b,c){this.element.innerHTML=c,this.element.style.top=this.TERMINAL.output.getLineByIndex(b).getElement().offsetTop+"px",this.element.style.left=(a-1)*this.TERMINAL.output.SYMBOL_PIXEL_WIDTH+"px",this.TERMINAL.elements.output.appendChild(this.element)},m.prototype.hide=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)};var n=function(a){this.TERMINAL=a,this.element=document.createElement("div"),this.initialize()};n.prototype.initialize=function(){this.element.className="terminalIndicator"},n.prototype.show=function(){this.TERMINAL.elements.output.appendChild(this.element)},n.prototype.hide=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)};var o=function(){this.KEYWORDS={"break":0,"catch":0,close:0,"continue":0,"do":0,d:0,"else":0,elseif:0,"for":0,"goto":0,halt:0,hang:0,h:0,"if":0,job:0,j:0,kill:0,k:0,lock:0,l:0,merge:0,"new":0,open:0,quit:0,q:0,read:0,r:0,"return":0,set:0,s:0,tcommit:0,"throw":0,trollback:0,"try":0,tstart:0,use:0,view:0,"while":0,write:0,w:0,xecute:0,x:0,zkill:0,znspace:0,zn:0,ztrap:0,zwrite:0,zw:0,zzdump:0,zzwrite:0,print:0,zbreak:0,zinsert:0,zload:0,zprint:0,zremove:0,zsave:0,zzprint:0,mv:0,mvcall:0,mvcrt:0,mvdim:0,mvprint:0,zquit:0,zsync:0,ascii:0,$bit:0,$bitcount:0,$bitfind:0,$bitlogic:0,$case:0,$char:0,$classmethod:0,$classname:0,$compile:0,$data:0,$decimal:0,$double:0,$extract:0,$factor:0,$find:0,$fnumber:0,$get:0,$increment:0,$inumber:0,$isobject:0,$isvaliddouble:0,$isvalidnum:0,$justify:0,$length:0,$list:0,$listbuild:0,$listdata:0,$listfind:0,$listfromstring:0,$listget:0,$listlength:0,$listnext:0,$listsame:0,$listtostring:0,$listvalid:0,$locate:0,$match:0,$method:0,$name:0,$nconvert:0,$next:0,$normalize:0,$now:0,$number:0,$order:0,$parameter:0,$piece:0,$prefetchoff:0,$prefetchon:0,$property:0,$qlength:0,$qsubscript:0,$query:0,$random:0,$replace:0,$reverse:0,$sconvert:0,$select:0,$sortbegin:0,$sortend:0,$stack:0,$text:0,$translate:0,$view:0,$wascii:0,$wchar:0,$wextract:0,$wfind:0,$wiswide:0,$wlength:0,$wreverse:0,$xecute:0,$zabs:0,$zarccos:0,$zarcsin:0,$zarctan:0,$zcos:0,$zcot:0,$zcsc:0,$zdate:0,$zdateh:0,$zdatetime:0,$zdatetimeh:0,$zexp:0,$zhex:0,$zln:0,$zlog:0,$zpower:0,$zsec:0,$zsin:0,$zsqr:0,$ztan:0,$ztime:0,$ztimeh:0,$zboolean:0,$zconvert:0,$zcrc:0,$zcyc:0,$zdascii:0,$zdchar:0,$zf:0,$ziswide:0,$zlascii:0,$zlchar:0,$zname:0,$zposition:0,$zqascii:0,$zqchar:0,$zsearch:0,$zseek:0,$zstrip:0,$zwascii:0,$zwchar:0,$zwidth:0,$zwpack:0,$zwbpack:0,$zwunpack:0,$zwbunpack:0,$zzenkaku:0,$change:0,$mv:0,$mvat:0,$mvfmt:0,$mvfmts:0,$mviconv:0,$mviconvs:0,$mvinmat:0,$mvlover:0,$mvoconv:0,$mvoconvs:0,$mvraise:0,$mvtrans:0,$mvv:0,$mvname:0,$zbitand:0,$zbitcount:0,$zbitfind:0,$zbitget:0,$zbitlen:0,$zbitnot:0,$zbitor:0,$zbitset:0,$zbitstr:0,$zbitxor:0,$zincrement:0,$znext:0,$zorder:0,$zprevious:0,$zsort:0,device:0,$ecode:0,$estack:0,$etrap:0,$halt:0,$horolog:0,$io:0,$job:0,$key:0,$namespace:0,$principal:0,$quit:0,$roles:0,$storage:0,$system:0,$test:0,$this:0,$tlevel:0,$username:0,$x:0,$y:0,$za:0,$zb:0,$zchild:0,$zeof:0,$zeos:0,$zerror:0,$zhorolog:0,$zio:0,$zjob:0,$zmode:0,$znspace:0,$zparent:0,$zpi:0,$zpos:0,$zreference:0,$zstorage:0,$ztimestamp:0,$ztimezone:0,$ztrap:0,$zversion:0,"##class":0}},p=function(a){this.TERMINAL=a,this.ENABLED=!1,this.history=new r(this),this.caret=new q(this),this._autocompleteVariants=[],this._currentAutocompleteVariant=0,this._autocompleteHint=new m(this.TERMINAL),this.__inputLastLength=0,this._handler=null,this.__readingChar=!1,this.INITIAL_POSITION={line:0,position:0},this.initialize()
};p.prototype.initialize=function(){var a=this;window.addEventListener("keypress",function(){a.ENABLED&&document.activeElement!==a.TERMINAL.elements.input&&a.focus()}),this.TERMINAL.elements.terminal.addEventListener("touchend",function(b){a.ENABLED&&document.getSelection().isCollapsed&&(b.preventDefault(),a.focus())}),this.TERMINAL.elements.input.addEventListener("input",function(){a.ENABLED&&a._onInput()}),this.TERMINAL.elements.input.addEventListener("keydown",function(b){a.ENABLED&&a.keyDown(b)})},p.prototype.focus=function(){this.TERMINAL.elements.input.blur(),this.TERMINAL.elements.input.focus()},p.prototype.set=function(a){var b=this.TERMINAL.elements.input;b.value=a,this.setCaretPosition(b.value.length),this._onInput()},p.prototype._enable=function(){this.ENABLED=!0,this.TERMINAL.elements.input.removeAttribute("disabled"),this.focus(),this.caret.update()},p.prototype._disable=function(){this.TERMINAL.elements.input.setAttribute("disabled",""),this.ENABLED=!1,this.caret.hide()},p.prototype.getCaretPosition=function(){return"undefined"!=typeof this.TERMINAL.elements.input.selectionStart?this.TERMINAL.elements.input.selectionStart:this.TERMINAL.elements.input.value.length},p.prototype.get=function(){return this.TERMINAL.elements.input.value},p.prototype.setCaretPosition=function(a){this.TERMINAL.elements.input.selectionStart=this.TERMINAL.elements.input.selectionEnd=a},p.prototype.complete=function(){var a=this.getCurrentAutocompleteVariant(),b=this.getCaretPosition();a&&(this.set(this.get().splice(b,0,a)),this.setCaretPosition(b+a.length),this._onInput())},p.prototype.getCurrentAutocompleteVariant=function(){return this._autocompleteVariants[this._currentAutocompleteVariant]||""},p.prototype._changeAutocompleteVariant=function(a){this._currentAutocompleteVariant=(this._currentAutocompleteVariant+a)%this._autocompleteVariants.length||0,this._currentAutocompleteVariant<0&&(this._currentAutocompleteVariant+=this._autocompleteVariants.length||0),this._updateAutocompleteView()},p.prototype._updateAutocompleteView=function(){var a=this.getCurrentAutocompleteVariant();return a?void this._autocompleteHint.show((this.INITIAL_POSITION.position+this.getCaretPosition())%this.TERMINAL.output.WIDTH+1,this.INITIAL_POSITION.line+Math.floor((this.INITIAL_POSITION.position+this.getCaretPosition())/this.TERMINAL.output.WIDTH),a):void this._autocompleteHint.hide()},p.prototype.clearAutocompleteVariants=function(){this._autocompleteVariants=[],this._currentAutocompleteVariant=0},p.prototype._onInput=function(){var a,b,c,d="",e=this.TERMINAL.elements.input.value,f=e.length;for(this.TERMINAL.settings.AUTOCOMPLETE&&(this._autocompleteVariants=this.TERMINAL.autocomplete.getEndings(e.substring(0,this.getCaretPosition())),this._changeAutocompleteVariant(0)),this.TERMINAL.output.printAtLine(this.TERMINAL.settings.HIGHLIGHT_INPUT?this.TERMINAL.parser.highlightSyntax(e,this.TERMINAL.theme.getCurrentTheme()):e,this.INITIAL_POSITION.line,this.INITIAL_POSITION.position,!1),a=0;a<this.__inputLastLength-f;a++)d+=" ";b=this.TERMINAL.output.getCaretX(),c=this.TERMINAL.output.getCaretY(),this.TERMINAL.output.$CARET_RESTRICTION_ON=!1,this.TERMINAL.output.printSync(d),this.TERMINAL.output.$CARET_RESTRICTION_ON=!0,this.TERMINAL.output.getCaretY()<1&&this.TERMINAL.output.increaseTopLine(this.TERMINAL.output.getCaretY()-1),this.TERMINAL.output.setCaretX(b),this.TERMINAL.output.setCaretY(c),this.__inputLastLength=f+this.getCurrentAutocompleteVariant().length,f===this.TERMINAL.elements.input.maxLength&&this.submit(),this.TERMINAL.output.scrollToActualLine(),this._updateAutocompleteView(),this.caret.update()},p.prototype.keyDown=function(a){var b=a.charCode||a.keyCode,c=this;switch(b){case 9:this.complete(),a.preventDefault();break;case 13:this.set(this.TERMINAL.definitions.replace(this.TERMINAL.elements.input.value)),this.submit();break;case 16:break;case 17:this._changeAutocompleteVariant(1!==a.location?-1:1);break;case 35:setTimeout(function(){c._onInput()},1);break;case 36:setTimeout(function(){c._onInput()},1);break;case 37:setTimeout(function(){c._onInput()},1);break;case 39:setTimeout(function(){c._onInput()},1)}},p.prototype.submit=function(){var a=this.TERMINAL.elements.input.value,b=this._handler;this.TERMINAL.settings.SHOW_PROGRESS_INDICATOR&&this.TERMINAL.progressIndicator.show(),this._disable(),this.history.save(a),this.TERMINAL.elements.input.value="",this.__inputLastLength=0,this._autocompleteVariants=[],"function"==typeof b?(this._handler=null,b.call(this,a)):this.TERMINAL.controller.terminalQuery(a),this._updateAutocompleteView()},p.prototype.limitLength=function(a){this.TERMINAL.elements.input.maxLength=a},p.prototype.prompt=function(a,b,c){c&&(this._handler&&console.warn("Possible wrong handler usage."),this._handler=c),this.TERMINAL.progressIndicator.hide(),this.limitLength(b||32656),this.TERMINAL.output.printSync(a||""),this.INITIAL_POSITION.line=this.TERMINAL.output.getLineNumber(),this.INITIAL_POSITION.position=this.TERMINAL.output.getCaretX()-1,this._enable()
},p.prototype.getChar=function(a){var b=this,c=!1;if(this.__readingChar)return!1;this.__readingChar=!0,this.TERMINAL.progressIndicator.hide();var d=function(f){var g=f.keyCode,h=String.fromCharCode(g);16===g&&(c=!0),16!==g&&17!==g&&18!==g&&(h=c?h.toUpperCase():h.toLowerCase(),b.TERMINAL.output.print(h),window.removeEventListener("keydown",d,!0),window.removeEventListener("keyup",e,!0),f.preventDefault(),f.cancelBubble=!0,b.__readingChar=!1,a.call(b,h.charCodeAt(0).toString()))},e=function(a){16===a.keyCode&&(c=!1)};window.addEventListener("keydown",d,!0),window.addEventListener("keyup",e,!0)};var q=function(a){this.INPUT=a,this._element=document.createElement("div"),this.initialize()};q.prototype.CARET_CLASS_NAME="terminalCaret",q.prototype.initialize=function(){this._element.className=this.CARET_CLASS_NAME},q.prototype.update=function(){var a=this.INPUT.TERMINAL.output.getLineByIndex(this.INPUT.INITIAL_POSITION.line+Math.floor((this.INPUT.INITIAL_POSITION.position+this.INPUT.getCaretPosition())/this.INPUT.TERMINAL.output.WIDTH));return a?(this._element.style.left=(this.INPUT.INITIAL_POSITION.position+this.INPUT.TERMINAL.elements.input.selectionStart)%this.INPUT.TERMINAL.output.WIDTH*this.INPUT.TERMINAL.output.SYMBOL_PIXEL_WIDTH+"px",this._element.style.top=a.getElement().offsetTop+"px",void this.INPUT.TERMINAL.elements.output.appendChild(this._element)):void console.warn("Cannot get current terminal line element.")},q.prototype.hide=function(){this._element.parentNode&&this._element.parentNode.removeChild(this._element)};var r=function(a){this.INPUT=a,this._history=[""],this._currentPosition=0,this.initialize()};r.prototype.STORAGE_NAME="terminal-inputHistory",r.prototype.MAX_STACK_SIZE=200,r.prototype.initialize=function(){var a=this,b=this.INPUT.TERMINAL.storage.get(this.STORAGE_NAME);window.addEventListener("keydown",function(b){38===b.keyCode?(a.seek(-1),a.INPUT.set(a.getCurrent()),b.preventDefault(),b.cancelBubble=!0):40===b.keyCode&&(a.seek(1),a.INPUT.set(a.getCurrent()),b.preventDefault(),b.cancelBubble=!0)}),window.addEventListener("beforeunload",function(){a.INPUT.TERMINAL.storage.set(a.STORAGE_NAME,a.exportJSON())}),b&&(this.importJSON(b),this._currentPosition=this._history.length-1)},r.prototype.importJSON=function(a){var b,c;try{b=JSON.parse(a);for(c in this)this.hasOwnProperty(c)&&(this[c]=b[c]||this[c])}catch(d){console.error(d)}},r.prototype.exportJSON=function(){return JSON.stringify({_history:this._history})},r.prototype.seek=function(a){this._currentPosition=(a+this._currentPosition)%this._history.length,this._currentPosition<0&&(this._currentPosition+=this._history.length)},r.prototype.get=function(a){return this._history[a]||""},r.prototype.save=function(a){return this._history[this._history.length-2]===a||""===a?void(this._currentPosition=this._history.length-1):(this._history[this._history.length-1]=a,this._history.push(""),this._history.length>this.MAX_STACK_SIZE&&this._history.splice(0,1),void(this._currentPosition=this._history.length-1))},r.prototype.getCurrent=function(){return this._history[this._currentPosition]||""},r.prototype.load=function(a){return this._currentPosition+=a,this._currentPosition<0&&(this._currentPosition=history.length-1),this._currentPosition>=history.length&&(this._currentPosition=0),this.getCurrent()};var s=function(a){var b=this._TERMINAL=a;this.AVAILABLE_LOCALIZATIONS={en:"en",ru:"ru"},this._currentLocalization=this.AVAILABLE_LOCALIZATIONS.en,this._LOCALIZATION_BASE={1:{en:"Cach\xe9 WEB Terminal v"+b.VERSION+"\r\n\r\n\x1b[4mAvailable commands:\x1b[0m\r\n\x1b[33m/help\x1b[0m\x1b[32GShow the help information you are reading now.\r\n\x1b[33m/autocomplete\x1b[0m [sys]\x1b[32GPerforms autocomplete data loading. The system autocomplete file will be generated only the first time command execute. To generate system autocomplete again, use \x1b[1msys\x1b[0m parameter.\r\n\x1b[33m/echo\x1b[0m [param1] [param2] ...\x1b[32GEcho each argument of this command.\r\n\x1b[33m/trace\x1b[0m [global/filePath]\x1b[32GStart tracing global or file. To stop tracing, enter command without arguments. To stop tracing particular file or global, enter trace command again.\r\n\x1b[33m/sql\x1b[0m\x1b[32GEnter or exit SQL mode.\r\n\x1b[33m/reset\x1b[0m\x1b[32GReset terminal application to defaults.\r\n{command} \x1b[33m/favorite\x1b[0m {phrase}\x1b[32GSave command for future use.\r\n\x1b[33m/favorite\x1b[0m {phrase}\x1b[32GLoad previously saved command.\r\n{definition} \x1b[33m/define\x1b[0m {phrase}\x1b[32GReplace each next {phrase} with {definition}. To get more information, call command without parameters.\r\n\x1b[33m/version\x1b[0m\x1b[32GOutput terminal application version.\r\n\x1b[33m/update\x1b[0m\x1b[32GCheck for updates and prompt to update if new version available.\r\n\x1b[33m/settings\x1b[0m\x1b[32GShow or change terminal settings.\r\n\x1b[33m/about\x1b[0m\x1b[32GProject information.\r\n\r\n\x1b[4mControl keys:\x1b[0m\r\n\x1b[33mTAB\x1b[0m\x1b[32GComplete input if autocomplete variant available.\r\n\x1b[33mCTRL\x1b[0m\x1b[32GLeft/right control will switch next/previous available autocomplete variant.\r\n",ru:"Cach\xe9 WEB Terminal v"+b.VERSION+"\r\n\r\n\x1b[4m\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b:\x1b[0m\r\n\x1b[33m/help\x1b[0m\x1b[32G\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u043f\u043e\u043c\u0430\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e, \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0432\u044b \u0441\u0435\u0439\u0447\u0430\u0441 \u0447\u0438\u0442\u0430\u0435\u0442\u0435.\r\n\x1b[33m/autocomplete\x1b[0m [sys]\x1b[32G\u041f\u043e\u0434\u0433\u0440\u0443\u0436\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f. \u0424\u0430\u0439\u043b\u044b \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0433\u043e \u0430\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0431\u0443\u0434\u0443\u0442 \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u043f\u0435\u0440\u0432\u043e\u043c \u0432\u044b\u0437\u043e\u0432\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b. \u0415\u0441\u043b\u0438 \u0432\u044b \u0432\u043d\u0435\u0441\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432 \u0432\u0430\u0448 \u043a\u043e\u0434 \u0438\u043b\u0438 \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0445 \u043a\u043b\u0430\u0441\u0441\u043e\u0432, \u0432\u043e\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435\u0441\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u043c \x1b[1msys\x1b[0m.\r\n\x1b[33m/echo\x1b[0m [\u043f\u0430\u0440\u0430\u043c\u0435\u0442\u04401] [\u0432\u0442\u043e\u0440\u043e\u0439] ...\x1b[32G\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043a\u0430\u0436\u0434\u044b\u0439 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u043a\u043e\u043c\u0430\u043d\u0434\u044b.\r\n\x1b[33m/trace\x1b[0m [\u0433\u043b\u043e\u0431\u0430\u043b/\u043f\u0443\u0442\u044c]\x1b[32G\u041d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u044c \u0437\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u043c\u0438 \u0432 \u0444\u0430\u0439\u043b\u0435 \u0438\u043b\u0438 \u0433\u043b\u043e\u0431\u0430\u043b\u0435. \u0427\u0442\u043e\u0431\u044b \u043f\u0435\u0440\u0435\u0441\u0442\u0430\u0442\u044c \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u044c \u0437\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\u043c\u0438, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0435\u0449\u0451 \u0440\u0430\u0437. \u041a\u043e\u043c\u0430\u043d\u0434\u0430 \u0431\u0435\u0437 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 \u043d\u0430\u0431\u043b\u044e\u0434\u0435\u043d\u0438\u0435 \u0437\u0430 \u0432\u0441\u0435\u043c\u0438 \u0444\u0430\u0439\u043b\u0430\u043c\u0438 \u0438 \u0433\u043b\u043e\u0431\u0430\u043b\u0430\u043c\u0438.\r\n\x1b[33m/sql\x1b[0m\x1b[32G\u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u0438\u043b\u0438 \u0432\u044b\u0439\u0442\u0438 \u0438\u0437 SQL-\u0440\u0435\u0436\u0438\u043c\u0430.\r\n\x1b[33m/reset\x1b[0m\x1b[32G\u0412\u0435\u0440\u043d\u0443\u0442\u044c \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043b \u0432 \u043f\u0435\u0440\u0432\u043e\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435.\r\n{\u043a\u043e\u043c\u0430\u043d\u0434\u0430} \x1b[33m/favorite\x1b[0m {\u0444\u0440\u0430\u0437\u0430}\x1b[32G\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0434\u043b\u044f \u0434\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0435\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f.\r\n\x1b[33m/favorite\x1b[0m {\u0444\u0440\u0430\u0437\u0430}\x1b[32G\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 \u0440\u0430\u043d\u0435\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u0443\u044e \u043a\u043e\u043c\u0430\u043d\u0434\u0443.\r\n{\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435} \x1b[33m/define\x1b[0m {\u0444\u0440\u0430\u0437\u0430}\x1b[32G\u0417\u0430\u043c\u0435\u043d\u044f\u0442\u044c \u043a\u0443\u0436\u0434\u0443\u044e {\u0444\u0440\u0430\u0437\u0443} {\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435\u043c}. \u0427\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438, \u0432\u044b\u0437\u043e\u0432\u0438\u0442\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0431\u0435\u0437 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432.\r\n\x1b[33m/version\x1b[0m\x1b[32G\u0412\u044b\u0432\u0435\u0441\u0442\u0438 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0432\u0435\u0440\u0441\u0438\u0438 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043b\u0430.\r\n\x1b[33m/update\x1b[0m\x1b[32G\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439 \u0438 \u0441\u043f\u0440\u043e\u0441\u0438\u0442\u044c \u0443 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u043d\u0443\u0436\u043d\u043e \u043b\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435, \u0435\u0441\u043b\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u043d\u043e\u0432\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f.\r\n\x1b[33m/settings\x1b[0m\x1b[32G\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0438\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043b\u0430.\r\n\x1b[33m/about\x1b[0m\x1b[32G\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043f\u0440\u043e\u0435\u043a\u0442\u0435.\r\n\r\n\x1b[4m\u0423\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0435 \u043a\u043b\u0430\u0432\u0438\u0448\u0438:\x1b[0m\r\n\x1b[33mTAB\x1b[0m\x1b[32G\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0432\u043e\u0434, \u0435\u0441\u043b\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0430\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f.\r\n\x1b[33mCTRL\x1b[0m\x1b[32G\u041b\u0435\u0432\u044b\u0439/\u043f\u0440\u0430\u0432\u044b\u0439 CTRL \u043f\u0435\u0440\u0435\u0439\u0434\u0451\u0442 \u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c\u0443/\u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u043c\u0443 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e\u043c\u0443 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0443 \u0430\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f.\r\n"},2:{en:"Connection to Cach\xe9 Server established.",ru:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c Cach\xe9 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e."},3:{en:"Unable to send data to server.",ru:"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440."},4:{en:"WebSocket connection closed. Code %n, reason: %s.",ru:"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 WebSocket \u0437\u0430\u043a\u0440\u044b\u0442\u043e. \u041a\u043e\u0434 %n, \u043f\u0440\u0438\u0447\u0438\u043d\u0430: %s."},5:{en:"Unable to trace %s.",ru:"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u044c \u0437\u0430 %s."},6:{en:"WebSocket connection error (%s). Trying to connect again in %n seconds...",ru:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f WebSocket (%s). \u041f\u043e\u0432\u0442\u043e\u0440\u043d\u0430\u044f \u043f\u043e\u043f\u044b\u0442\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0447\u0435\u0440\u0435\u0437 %n \u0441\u0435\u043a\u0443\u043d\u0434..."},7:{en:"Start tracing %s.",ru:"\u041d\u0430\u0431\u043b\u044e\u0434\u0435\u043d\u0438\u0435 \u0437\u0430 %s \u043d\u0430\u0447\u0430\u0442\u043e."},8:{en:"Stop tracing %s.",ru:"\u041d\u0430\u0431\u043b\u044e\u0434\u0435\u043d\u0438\u0435 \u0437\u0430 %s \u0437\u0430\u043a\u043e\u043d\u0447\u0435\u043d\u043e."},9:{en:"Refresh page to apply reset.",ru:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0441\u0431\u0440\u043e\u0441."},10:{en:"Authorization successful.",ru:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0448\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e."},11:{en:"Usage:\r\n{your command} \x1b[1m/favorite\x1b[0m {name}\x1b[35GTo save command.\r\n\x1b[1m/favorite\x1b[0m {name} \x1b[35GTo load command.\r\nPreviously saved names: %s.",ru:"\u0423\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435:\r\n{\u043a\u043e\u043c\u0430\u043d\u0434\u0430} \x1b[1m/favorite\x1b[0m {\u0438\u043c\u044f}\x1b[35G\u0414\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u044b.\r\n\x1b[1m/favorite\x1b[0m {\u0438\u043c\u044f} \x1b[35G\u0414\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043a\u043e\u043c\u0430\u043d\u0434\u044b.\r\n\u0420\u0430\u043d\u0435\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u043e\u0434 \u0438\u043c\u0435\u043d\u0430\u043c\u0438: %s."},12:{en:'No command saved for "%s".\r\nPreviously saved: %s.',ru:'\u041a\u043e\u043c\u0430\u043d\u0434\u0430 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c "%s" \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430.\r\n\u0420\u0430\u043d\u0435\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d\u043d\u044b\u0435: %s.'},13:{en:"%s\x1b[1m defined as \x1b[0m%s",ru:"%s\x1b[1m \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e \u043a\u0430\u043a \x1b[0m%s"},14:{en:"Definitions removed.",ru:"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u044b."},15:{en:'\x1b[4mUsage:\x1b[0m\r\n\x1b[1m/define\x1b[0m {everything} {phrase}\x1b[35GTo define {phrase} as {everything}.\r\n\x1b[1m/define\x1b[0m clear\x1b[35GClears all definitions.\r\n\x1b[4mExample:\x1b[0m \x1b[2m##class(%Library.File).Exists( \x1b[0m\x1b[1m/define\x1b[0m \x1b[2m?f(\x1b[0m \r\nThis will set shorten expression for checking if file exists. Then, commands like \x1b[2mw ?f("C:")\x1b[0m will be automatically replaced with \x1b[2mw ##class(%Library.File).Exists("C:")\x1b[0m when submitting. To clear definitions, give "clear" parameter.\r\n\x1b[4mList of definitions:\x1b[0m %s.',ru:'\x1b[4m\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435:\x1b[0m\r\n\x1b[1m/define\x1b[0m {\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435} {\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435}\x1b[35G\u041a\u0430\u0436\u0434\u043e\u0435 \u0432\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u0435 {\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f} \u0432 \u0441\u0442\u0440\u043e\u043a\u0443 \u0432\u0432\u043e\u0434\u0430 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043c\u0435\u043d\u0435\u043d\u043e \u043d\u0430 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u0435 {\u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435}.\r\n\x1b[1m/define\x1b[0m clear\x1b[35G\u0423\u0434\u0430\u043b\u0438\u0442 \u0432\u0441\u0435 \u0440\u0430\u043d\u0435\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f.\r\n\x1b[4m\u041f\u0440\u0438\u043c\u0435\u0440:\x1b[0m \x1b[2m##class(%Library.File).Exists( \x1b[0m\x1b[1m/define\x1b[0m \x1b[2m?f(\x1b[0m \r\n\u042d\u0442\u043e \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442 \u0441\u043e\u043a\u0440\u0430\u0449\u0451\u043d\u043d\u043e\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u044f \u0444\u0430\u0439\u043b\u0430. \u041f\u043e\u0441\u043b\u0435, \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u0432\u0438\u0434\u0430 \x1b[2mw ?f("C:")\x1b[0m \u0431\u0443\u0434\u0443\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u043d\u044b \u0432 \x1b[2mw ##class(%Library.File).Exists("C:")\x1b[0m \u043f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435. \u0427\u0442\u043e\u0431\u044b \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f, \u043f\u0435\u0440\u0435\u0434\u0430\u0439\u0442\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 "clear".\r\n\x1b[4m\u0421\u043f\u0438\u0441\u043e\u043a \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0439:\x1b[0m %s.'},16:{en:"Cach\xe9 WEB Terminal v%s\r\nChecking for updates...",ru:"Cach\xe9 WEB Terminal v%s\r\n\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439..."},17:{en:"",ru:""},18:{en:"Merging autocomplete database for %s...",ru:"\u041e\u0431\u044a\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 \u0430\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0434\u043b\u044f %s..."},19:{en:"Classes merged: %n",ru:"\u041a\u043b\u0430\u0441\u0441\u043e\u0432 \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0435\u043d\u043e: %n"},20:{en:"Globals merged: %n",ru:"\u0413\u043b\u043e\u0431\u0430\u043b\u043e\u0432 \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0435\u043d\u043e: %n"},21:{en:"No autocomplete file found on server. Requesting...",ru:"\u0424\u0430\u0439\u043b \u0430\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d. \u0417\u0430\u043f\u0440\u043e\u0441 \u0444\u0430\u0439\u043b\u0430..."},22:{en:"Authorization failed.",ru:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043d\u0435 \u0443\u0434\u0430\u043b\u0430\u0441\u044c."},23:{en:"A new version of Cach\xe9 WEB Terminal available. Would youlike to install it? (Make sure that user has write permission to CACHELIB database) (Y/N)",ru:"\u041d\u043e\u0432\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f Cach\xe9 WEB Terminal \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430. \u0425\u043e\u0442\u0438\u0442\u0435 \u043b\u0438 \u0432\u044b \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0435\u0451? (\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0438\u043c\u0435\u0435\u0442 \u043f\u0440\u0430\u0432\u0430 \u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0431\u0430\u0437\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 CACHELIB) (Y/N)"},24:{en:"Updating...",ru:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435..."},25:{en:"Cach\xe9 WEB Terminal is up-to-date.",ru:"\u041d\u0430 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0432\u0435\u0440\u0441\u0438\u044f Cach\xe9 WEB Terminal."},26:{en:"\x1b[4mCurrent settings:\x1b[0m\r\n%s \x1b[25G= %s (available: %s)\r\n%s \x1b[25G= %s (available: %s)\r\n%s \x1b[25G= %s\r\n%s \x1b[25G= %s\r\n%s \x1b[25G= %s\r\nTo change values, enter command with argument \x1b[3m{NAME}={VALUE}\x1b[0m.",ru:"\x1b[4m\u0422\u0435\u043a\u0443\u0449\u0438\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438:\x1b[0m\r\n%s \x1b[25G= %s (\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b: %s)\r\n%s \x1b[25G= %s (\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b: %s)\r\n%s \x1b[25G= %s\r\n%s \x1b[25G= %s\r\n%s \x1b[25G= %s\r\n\u0427\u0442\u043e\u0431\u044b \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u0443 \u0441 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u043c \x1b[3m{\u0418\u041c\u042f}={\u0417\u041d\u0410\u0427\u0415\u041d\u0418\u0415}\x1b[0m."},27:{en:"Terminal locale changed to %s.",ru:"\u042f\u0437\u044b\u043a \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043b\u0430 \u0438\u0437\u043c\u0435\u043d\u0451\u043d \u043d\u0430 %s."},28:{en:"Unable to change locale to %s.",ru:"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u044f\u0437\u044b\u043a \u043d\u0430 %s."},29:{en:"Start generating file",ru:"\u041d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0444\u0430\u0439\u043b\u0430"},30:{en:"Wrong namespace:",ru:"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f \u043e\u0431\u043b\u0430\u0441\u0442\u044c:"},31:{en:"Unable to create directory csp/WebTerminal/js/autocomplete.",ru:"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044e csp/WebTerminal/js/autocomplete."},32:{en:"Classes scanned:",ru:"\u0421\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u043a\u043b\u0430\u0441\u0441\u043e\u0432:"},33:{en:"Generation complete.",ru:"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430."},34:{en:"Request",ru:"\u0417\u0430\u043f\u0440\u043e\u0441"},35:{en:"Reading file...",ru:"\u0427\u0442\u0435\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430..."},36:{en:"Importing and compiling files...",ru:"\u0418\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0446\u0438\u044f \u0444\u0430\u0439\u043b\u043e\u0432..."},37:{en:"Clearing temporary files...",ru:"\u041e\u0447\u0438\u0441\u0442\u043a\u0430 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432..."},38:{en:"Client query unrecognized:",ru:"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0435 \u043e\u043f\u043e\u0437\u043d\u0430\u043d:"},39:{en:"Please, refresh the page to apply updates.",ru:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0447\u0442\u043e\u0431\u044b \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0432\u0441\u0442\u0443\u043f\u0438\u043b\u0438 \u0432 \u0441\u0438\u043b\u0443."},40:{en:"An error occurred when reading data.",ru:"\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0447\u0442\u0435\u043d\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445."},41:{en:"Theme changed to %s.",ru:"\u0412\u043d\u0435\u0448\u043d\u0438\u0439 \u0432\u0438\u0434 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043b\u0430 \u0438\u0437\u043c\u0435\u043d\u0451\u043d \u043d\u0430 %s."},42:{en:"Unable to change theme to %s.",ru:"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0442\u0435\u043c\u0443 \u043d\u0430 %s."},43:{en:"Cach\xe9 WEB Terminal v"+b.VERSION+"\r\nAuthor:\x1b[20GZitRo (+NikitaSavchenko)\r\nProject:\x1b[20Ghttp://intersystems-ru.github.io/webterminal\r\nRepository:\x1b[20Ghttps://github.com/intersystems-ru/webterminal\r\n2013-2014 \xa9",ru:"Cach\xe9 WEB Terminal v"+b.VERSION+"\r\n\u0410\u0432\u0442\u043e\u0440:\x1b[20GZitRo (+NikitaSavchenko)\r\n\u041f\u0440\u043e\u0435\u043a\u0442:\x1b[20Ghttp://intersystems-ru.github.io/webterminal\r\n\u0420\u0435\u043f\u043e\u0437\u0438\u0442\u043e\u0440\u0438\u0439:\x1b[20Ghttps://github.com/intersystems-ru/webterminal\r\n2013-2014 \xa9"},44:{en:"Syntax highlighting enabled.",ru:"\u041f\u043e\u0434\u0441\u0432\u0435\u0442\u043a\u0430 \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441\u0430 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u0430."},45:{en:"Syntax highlighting disabled.",ru:"\u041f\u043e\u0434\u0441\u0432\u0435\u0442\u043a\u0430 \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441\u0430 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0430."},46:{en:"Progress indicator enabled.",ru:"\u0418\u043d\u0434\u0438\u043a\u0430\u0442\u043e\u0440 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0432\u043a\u043b\u044e\u0447\u0451\u043d."},47:{en:"Progress indicator disabled.",ru:"\u0418\u043d\u0434\u0438\u043a\u0430\u0442\u043e\u0440 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d."},48:{en:"Autocomplete enabled.",ru:"\u0410\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043e."},49:{en:"Autocomplete disabled.",ru:"\u0410\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u043e."},50:{en:"Useless :)\r\nEnable autocomplete first.",ru:"\u0411\u0435\u0441\u043f\u043e\u043b\u0435\u0437\u043d\u043e :)\r\n\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0441\u043f\u0435\u0440\u0432\u0430 \u0430\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435."},51:{en:"Unknown option: %s.",ru:"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u043f\u0446\u0438\u044f: %s."},52:{en:"Loading autocomplete from local storage...",ru:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0430\u0432\u0442\u043e\u0434\u043e\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0438\u0437 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430..."},53:{en:"Loaded.",ru:"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043e."}},this.initialize()
};s.prototype.STORAGE_NAME="terminal-localization",s.prototype.initialize=function(){var a=this._TERMINAL.storage.get(this.STORAGE_NAME);a&&this.AVAILABLE_LOCALIZATIONS.hasOwnProperty(a)||(a=navigator.language,this.AVAILABLE_LOCALIZATIONS.hasOwnProperty(a)||(a="en")),this.setLocale(a)},s.prototype.getAvailableList=function(){var a,b=[];for(a in this.AVAILABLE_LOCALIZATIONS)b.push(a);return b},s.prototype.get=function(a){var b=0,c=arguments;return(this._LOCALIZATION_BASE[a]?this._LOCALIZATION_BASE[a][this._currentLocalization]||"[no available localization of ["+a+'] for "'+this._currentLocalization+'"]':"[translation ["+a+"] not found]").replace(/%[sn]/g,function(a){return"undefined"!=typeof c[++b]?"s"===a.charAt(1)?c[b].toString():parseFloat(c[b])+"":a})},s.prototype.setLocale=function(a){return this.AVAILABLE_LOCALIZATIONS.hasOwnProperty(a)?(this._currentLocalization=a,this._TERMINAL.storage.set(this.STORAGE_NAME,a),!0):(console.error('No available translations for "'+a+'". Please, check available languages at TerminalLocalization file.'),!1)},s.prototype.getLocale=function(){return this._currentLocalization};var t=function(a){this.TERMINAL=a,this._stack="",this._TOP_LINE_INDEX=0,this.SYMBOL_PIXEL_WIDTH=0,this.SYMBOL_PIXEL_HEIGHT=0,this.CONTROL_SEQUENCE_PATTERN=/[\x00-\x1A]|\x1b\[?[^@-~]*[@-~]/g,this.CURRENT_GRAPHIC_RENDITION={},this._lines=[],this._caret={x:1,y:1},this._scrolling={enabled:!1,lineStart:0,lineEnd:0},this._tabs={},this.$CARET_RESTRICTION_ON=!0,this.WIDTH=0,this.HEIGHT=0,this.STACK_REFRESH_INTERVAL=25,this.initialize()};t.prototype.COLOR_8BIT={0:"#000000",1:"#800000",2:"#008000",3:"#808000",4:"#000080",5:"#800080",6:"#008080",7:"#c0c0c0",8:"#808080",9:"#ff0000",10:"#00ff00",11:"#ffff00",12:"#0000ff",13:"#ff00ff",14:"#00ffff",15:"#ffffff",16:"#000000",17:"#00005f",18:"#000087",19:"#0000af",20:"#0000df",21:"#0000ff",22:"#005f00",23:"#005f5f",24:"#005f87",25:"#005faf",26:"#005fdf",27:"#005fff",28:"#008700",29:"#00875f",30:"#008787",31:"#0087af",32:"#0087df",33:"#0087ff",34:"#00af00",35:"#00af5f",36:"#00af87",37:"#00afaf",38:"#00afdf",39:"#00afff",40:"#00df00",41:"#00df5f",42:"#00df87",43:"#00dfaf",44:"#00dfdf",45:"#00dfff",46:"#00ff00",47:"#00ff5f",48:"#00ff87",49:"#00ffaf",50:"#00ffdf",51:"#00ffff",52:"#5f0000",53:"#5f005f",54:"#5f0087",55:"#5f00af",56:"#5f00df",57:"#5f00ff",58:"#5f5f00",59:"#5f5f5f",60:"#5f5f87",61:"#5f5faf",62:"#5f5fdf",63:"#5f5fff",64:"#5f8700",65:"#5f875f",66:"#5f8787",67:"#5f87af",68:"#5f87df",69:"#5f87ff",70:"#5faf00",71:"#5faf5f",72:"#5faf87",73:"#5fafaf",74:"#5fafdf",75:"#5fafff",76:"#5fdf00",77:"#5fdf5f",78:"#5fdf87",79:"#5fdfaf",80:"#5fdfdf",81:"#5fdfff",82:"#5fff00",83:"#5fff5f",84:"#5fff87",85:"#5fffaf",86:"#5fffdf",87:"#5fffff",88:"#870000",89:"#87005f",90:"#870087",91:"#8700af",92:"#8700df",93:"#8700ff",94:"#875f00",95:"#875f5f",96:"#875f87",97:"#875faf",98:"#875fdf",99:"#875fff",100:"#878700",101:"#87875f",102:"#878787",103:"#8787af",104:"#8787df",105:"#8787ff",106:"#87af00",107:"#87af5f",108:"#87af87",109:"#87afaf",110:"#87afdf",111:"#87afff",112:"#87df00",113:"#87df5f",114:"#87df87",115:"#87dfaf",116:"#87dfdf",117:"#87dfff",118:"#87ff00",119:"#87ff5f",120:"#87ff87",121:"#87ffaf",122:"#87ffdf",123:"#87ffff",124:"#af0000",125:"#af005f",126:"#af0087",127:"#af00af",128:"#af00df",129:"#af00ff",130:"#af5f00",131:"#af5f5f",132:"#af5f87",133:"#af5faf",134:"#af5fdf",135:"#af5fff",136:"#af8700",137:"#af875f",138:"#af8787",139:"#af87af",140:"#af87df",141:"#af87ff",142:"#afaf00",143:"#afaf5f",144:"#afaf87",145:"#afafaf",146:"#afafdf",147:"#afafff",148:"#afdf00",149:"#afdf5f",150:"#afdf87",151:"#afdfaf",152:"#afdfdf",153:"#afdfff",154:"#afff00",155:"#afff5f",156:"#afff87",157:"#afffaf",158:"#afffdf",159:"#afffff",160:"#df0000",161:"#df005f",162:"#df0087",163:"#df00af",164:"#df00df",165:"#df00ff",166:"#df5f00",167:"#df5f5f",168:"#df5f87",169:"#df5faf",170:"#df5fdf",171:"#df5fff",172:"#df8700",173:"#df875f",174:"#df8787",175:"#df87af",176:"#df87df",177:"#df87ff",178:"#dfaf00",179:"#dfaf5f",180:"#dfaf87",181:"#dfafaf",182:"#dfafdf",183:"#dfafff",184:"#dfdf00",185:"#dfdf5f",186:"#dfdf87",187:"#dfdfaf",188:"#dfdfdf",189:"#dfdfff",190:"#dfff00",191:"#dfff5f",192:"#dfff87",193:"#dfffaf",194:"#dfffdf",195:"#dfffff",196:"#ff0000",197:"#ff005f",198:"#ff0087",199:"#ff00af",200:"#ff00df",201:"#ff00ff",202:"#ff5f00",203:"#ff5f5f",204:"#ff5f87",205:"#ff5faf",206:"#ff5fdf",207:"#ff5fff",208:"#ff8700",209:"#ff875f",210:"#ff8787",211:"#ff87af",212:"#ff87df",213:"#ff87ff",214:"#ffaf00",215:"#ffaf5f",216:"#ffaf87",217:"#ffafaf",218:"#ffafdf",219:"#ffafff",220:"#ffdf00",221:"#ffdf5f",222:"#ffdf87",223:"#ffdfaf",224:"#ffdfdf",225:"#ffdfff",226:"#ffff00",227:"#ffff5f",228:"#ffff87",229:"#ffffaf",230:"#ffffdf",231:"#ffffff",232:"#080808",233:"#121212",234:"#1c1c1c",235:"#262626",236:"#303030",237:"#3a3a3a",238:"#444444",239:"#4e4e4e",240:"#585858",241:"#606060",242:"#666666",243:"#767676",244:"#808080",245:"#8a8a8a",246:"#949494",247:"#9e9e9e",248:"#a8a8a8",249:"#b2b2b2",250:"#bcbcbc",251:"#c6c6c6",252:"#d0d0d0",253:"#dadada",254:"#e4e4e4",255:"#eeeeee"},t.prototype.initialize=function(){var a,b=this;
for(setInterval(function(){b.freeStack()},this.STACK_REFRESH_INTERVAL),window.addEventListener("resize",function(){b.sizeChanged()}),this.sizeChanged(),a=9;a<this.WIDTH;a+=8)this.setTab(a)},t.prototype.setTab=function(a){this._tabs[a]=!0},t.prototype.clearTab=function(a){a?delete this._tabs[a]:this._tabs={}},t.prototype.setCaretX=function(a){return this._caret.x=Math.max(1,Math.min(this.WIDTH,a)),a===this._caret.x},t.prototype.setCaretY=function(a){return this._caret.y=this.$CARET_RESTRICTION_ON?Math.max(1,Math.min(this.HEIGHT,a)):a,a===this._caret.y},t.prototype.increaseTopLine=function(a){this._TOP_LINE_INDEX+=Math.round(a),this._TOP_LINE_INDEX<0&&(this._TOP_LINE_INDEX=0,console.warn("_TOP_LINE_INDEX = 0 bottom restriction applied."))},t.prototype.enableScrolling=function(a,b){return b>this.HEIGHT||1>a||a>b?void console.warn("Wrong scrolling borders: ",a,b):(this._scrolling.enabled=!0,this._scrolling.lineStart=a,this._scrolling.lineEnd=b,this.setCaretX(1),void this.setCaretY(1))},t.prototype.disableScrolling=function(){this._scrolling.enabled=!1},t.prototype.scrollDisplayPart=function(a,b,c){var d,e=this.getLineByIndex(this._TOP_LINE_INDEX+b),f=this._lines.slice(this._TOP_LINE_INDEX+a-1,this._TOP_LINE_INDEX+b),g={getElement:function(){return null}},h=f.length,i=f.slice(Math.min(Math.max(0,c),h),Math.max(Math.min(h,h+c),0)),j=c>0?(e||g).getElement()||null:(i[0]||g).getElement()||(e||g).getElement()||null,k=f.length-i.length;for(d=0;k>d;d++)f[c>0?"shift":"pop"]().remove();for(d=0;k>d;d++)i[c>0?"push":"unshift"].apply(i,[new u(this,j)]);this._lines.splice.apply(this._lines,[this._TOP_LINE_INDEX+a-1,i.length].concat(i))},t.prototype.getCaretX=function(){return this._caret.x},t.prototype.getCaretY=function(){return this._caret.y},t.prototype._controlCharacters={"\x00":function(){},"	":function(){for(var a=this.getCaretX();a<this.WIDTH;a++)if(this._tabs.hasOwnProperty(a.toString())){this.setCaretX(a);break}},"\n":function(){this._scrolling.enabled&&this._caret.y===this._scrolling.lineEnd?this.scrollDisplayPart(this._scrolling.lineStart,this._scrolling.lineEnd,1):(this._caret.y===this.HEIGHT&&this.scrollDisplay(1),this.setCaretY(this._caret.y+1))},"\r":function(){this.setCaretX(1)}},t.prototype._controlSequences={m:function(a,b){var c,d=b.split(";").map(function(a){return parseInt(a,10)});for(c=0;c<d.length;c++)38===d[c]&&5===d[c+1]?(this.setGraphicRendition(38,"color: "+this.COLOR_8BIT[d[c+2]]),c+=2):48===d[c]&&5===d[c+1]?(this.setGraphicRendition(48,"background-color: "+this.COLOR_8BIT[d[c+2]]),c+=2):this.setGraphicRendition(d[c]||0)},A:function(a,b){this.setCaretY(this.getCaretY()-(parseInt(b)||1))},B:function(a,b){this.setCaretY(this.getCaretY()+(parseInt(b)||1))},C:function(a,b){this.setCaretX(this.getCaretX()+(parseInt(b)||1))},D:function(a,b){"["===a.charAt(1)?this.setCaretX(this.getCaretX()-(parseInt(b)||1)):this._scrolling.enabled&&this.scrollDisplayPart(this._scrolling.lineStart,this._scrolling.lineEnd,-1)},M:function(){this._scrolling.enabled&&this.scrollDisplayPart(this._scrolling.lineStart,this._scrolling.lineEnd,1)},f:function(a,b){var c=b.split(";");this.setCaretX(parseInt(c[1]||1)),this.setCaretY(parseInt(c[0]||1))},H:function(a,b){"["===a.charAt(1)?this._controlSequences.f.call(this,a,b):this.setTab(this.getCaretX())},g:function(a,b){"3"===b?this.clearTab():this.clearTab(this.getCaretX())},G:function(a,b){this.setCaretX(parseInt(b)||1)},c:function(a){var b=1;"\x1b[c"===a&&this.TERMINAL.controller.terminalQuery("\x1b["+b+"0c")},n:function(a,b){switch(parseInt(b)){case 5:this.TERMINAL.controller.terminalQuery("\x1b[0n");break;case 6:this.TERMINAL.controller.terminalQuery("\x1b["+this.getCaretY()+";"+this.getCaretX()+"R")}},r:function(a,b){var c;b?(c=b.split(";").map(function(a){return parseInt(a,10)}),c.length>1&&this.enableScrolling(c[0],c[1])):this.disableScrolling()},K:function(a,b){1==b?this.getCurrentLine().writePlain(new Array(this.getCaretX()).join(" "),0):2==b?this.getCurrentLine().writePlain(new Array(this.WIDTH+1).join(" "),0):this.getCurrentLine().writePlain(new Array(this.WIDTH-this.getCaretX()+2).join(" "),this.getCaretX()-1)},J:function(a,b){var c;if(1==b)for(c=this.getCaretY();c>0;c--)this.getLineByCursorY(c).clear();else if(2==b)for(c=1;c<this.WIDTH;c++)this.getLineByCursorY(c).clear();else for(c=this.getCaretY()+1;c<this.HEIGHT;c++)this.getLineByCursorY(c).clear()}},t.prototype.scrollDisplay=function(a){a>0?this._TOP_LINE_INDEX+=a:console.warn("Todo: scroll up")},t.prototype.anyGraphicRenditionSet=function(){var a;for(a in this.CURRENT_GRAPHIC_RENDITION)if(this.CURRENT_GRAPHIC_RENDITION.hasOwnProperty(a))return!0;return!1},t.prototype.setGraphicRendition=function(a,b){0===a?this.CURRENT_GRAPHIC_RENDITION={}:this.CURRENT_GRAPHIC_RENDITION[a]=b?{style:b}:a},t.prototype.applyControlSequence=function(a){var b,c;(b=a.match(/[\x00-\x1A]/))?this._controlCharacters.hasOwnProperty(b[0])&&this._controlCharacters[b[0]].call(this):(b=a.match(/\x1b\[?([^@-~]*)([@-~])/))&&(c=b[2],this._controlSequences.hasOwnProperty(c)&&this._controlSequences[c].call(this,b[0],b[1]))
},t.prototype.getTopLine=function(){var a;for(a=this._lines.length;a<=this._TOP_LINE_INDEX;a++)this._lines[a]=new u(this);return this._lines[this._TOP_LINE_INDEX]},t.prototype.getCurrentLine=function(){return this.getLineByCursorY(this.getCaretY())},t.prototype.newLineSequence=function(){this.applyControlSequence("\r"),this.applyControlSequence("\n")},t.prototype.getLineNumber=function(){return this._TOP_LINE_INDEX+this._caret.y-1},t.prototype._spawnLines=function(a){for(;a>0;a--)this._lines.push(new u(this))},t.prototype._printPlainText=function(a){var b,c;do b=this.getCurrentLine(),c=a.length,a=b.writePlain(a,this._caret.x-1),c-=a.length,a?this.newLineSequence():this.setCaretX(this._caret.x+c)||this.newLineSequence();while(a)},t.prototype._output=function(a){var b,c=a||"",d=0,e=this;a=a||"",a.replace(this.CONTROL_SEQUENCE_PATTERN,function(a,b,f){var g=f.substring(d,b);return d||(c=f),d=b+a.length,g&&e._printPlainText(g),e.applyControlSequence(a),""}),b=c.substring(d,c.length),b&&this._printPlainText(b)},t.prototype.print=function(a){this._stack+=a},t.prototype.getLineByIndex=function(a){var b;for(b=this._lines.length;a>=b;b++)this._lines[b]=new u(this);return this._lines[a]},t.prototype.getLineByCursorY=function(a){return this.getLineByIndex(this._TOP_LINE_INDEX+(a-1))},t.prototype.printAtLine=function(a,b,c,d){var e=this.$CARET_RESTRICTION_ON;"undefined"==typeof d&&(d=!0),this.$CARET_RESTRICTION_ON=!1,this._caret.x=c+1,this._caret.y=b-this._TOP_LINE_INDEX+1,this.printSync(a),d&&(this.$CARET_RESTRICTION_ON=!0,this.setCaretX(this.getCaretX()),this.setCaretY(this.getCaretY())),this.$CARET_RESTRICTION_ON=e},t.prototype.printSync=function(a){this.freeStack(),this.print(a||""),this.freeStack()},t.prototype.freeStack=function(){var a,b;this._stack&&(-1!==(a=this._stack.lastIndexOf(String.fromCharCode(27)))&&(b=(a=this._stack.substring(a,this._stack.length)).match(this.CONTROL_SEQUENCE_PATTERN))&&"\x1b["!==b[0]?(this._output(this._stack),this._stack=""):(this._output(this._stack.substring(0,this._stack.length-(a.length||0))),this._stack=-1===a?"":a),this.scrollToActualLine())},t.prototype.clear=function(){this.printSync(),this._TOP_LINE_INDEX=this._lines.length,this._spawnLines(this.HEIGHT),this.scrollToActualLine(),this.setCaretX(1),this.setCaretY(1)},t.prototype.scrollToActualLine=function(){this.TERMINAL.elements.output.scrollTop=this.getTopLine().getElement().offsetTop},t.prototype.sizeChanged=function(){var a,b=document.createElement("span"),c=document.createElement("div"),d=this.TERMINAL.elements.output.style.overflowY,e=6;this.TERMINAL.elements.output.style.overflowY="scroll",this.TERMINAL.elements.output.appendChild(c),a=this.TERMINAL.elements.output.offsetWidth-c.offsetWidth,this.TERMINAL.elements.output.style.overflowY=d,b.className=this.LINE_CLASSNAME,b.innerHTML="XXXXXXXXXX",this.TERMINAL.elements.output.appendChild(b),this.SYMBOL_PIXEL_WIDTH=b.offsetWidth/10,this.SYMBOL_PIXEL_HEIGHT=b.offsetHeight,this.WIDTH=Math.floor((this.TERMINAL.elements.terminal.offsetWidth-a-e)/this.SYMBOL_PIXEL_WIDTH),this.HEIGHT=Math.floor(this.TERMINAL.elements.terminal.offsetHeight/this.SYMBOL_PIXEL_HEIGHT),this.TERMINAL.elements.output.style.width=this.WIDTH*this.SYMBOL_PIXEL_WIDTH+a+"px",this.TERMINAL.elements.output.style.height=this.HEIGHT*this.SYMBOL_PIXEL_HEIGHT+"px",this.TERMINAL.elements.output.removeChild(c),this.TERMINAL.elements.output.removeChild(b)};var u=function(a,b){this.TERMINAL=a.TERMINAL,this.TERMINAL_OUTPUT=a,this._lineElement=document.createElement("div"),this._linePlainText="",this.graphicRenditionIndex={},this.renderTimeout=0,this.initialize(b)};u.prototype.initialize=function(a){this._lineElement.style.height=this.TERMINAL_OUTPUT.SYMBOL_PIXEL_HEIGHT+"px",a?this.TERMINAL.elements.output.insertBefore(this._lineElement,a):this.TERMINAL.elements.output.appendChild(this._lineElement)},u.prototype.getElement=function(){return this._lineElement},u.prototype.render=function(){var a,b,c,d=[],e="";for(a in this.graphicRenditionIndex)d.push(parseInt(a));for(d.sort(function(a,b){return a-b}),0!==d[0]&&d.unshift(0),a=0;a<d.length;a++)b="",c="",(this.graphicRenditionIndex[d[a]]||[]).every(function(a){return b+="term-gri"+a.index+" ",a.style&&(c+=(c?";":"")+a.style+" "),!0},this),b&&(b='<span class="'+b+'"'+(c?'style="'+c.replace('"',"&quot;")+'"':"")+">"),e+=b+this._linePlainText.substring(d[a]||0,d[a+1]||this._linePlainText.length).replace(/&/g,"&amp;").replace(/</g,"&lt;")+"</span>";e||(e=this._linePlainText.replace(/&/g,"&amp;").replace(/</g,"&lt;")),this._lineElement.innerHTML=e},u.prototype.writePlain=function(a,b){var c,d,e=this;for("undefined"==typeof b&&(b=this._linePlainText.length),d=a.substr(0,this.TERMINAL_OUTPUT.WIDTH-b),b>this._linePlainText.length&&(this._linePlainText+=new Array(b-this._linePlainText.length+1).join(" ")),this._linePlainText=this._linePlainText.splice(b,d.length,d),c=b;c<b+d.length;c++)this.graphicRenditionIndex.hasOwnProperty(c.toString())&&(this.graphicRenditionIndex[b+d.length]=(this.graphicRenditionIndex[b+d.length]||[]).concat(this.graphicRenditionIndex[c]),delete this.graphicRenditionIndex[c]);
if(this.graphicRenditionIndex[b+d.length]instanceof Array){for(c=0;c<this.graphicRenditionIndex[b+d.length].length;c++)0===this.graphicRenditionIndex[b+d.length][c].index&&(this.graphicRenditionIndex[b+d.length].splice(0,c+1),c=0);this.graphicRenditionIndex[b+d.length]=this.graphicRenditionIndex[b+d.length].filter(function(a,b,d){for(c=0;b>c;c++)if(d[b].index===d[c].index)return!1;return!0})}if(this.TERMINAL_OUTPUT.anyGraphicRenditionSet()){this.graphicRenditionIndex[b]=[];for(c in this.TERMINAL_OUTPUT.CURRENT_GRAPHIC_RENDITION)this.graphicRenditionIndex[b].push({index:parseInt(c)||c,style:this.TERMINAL_OUTPUT.CURRENT_GRAPHIC_RENDITION[c].style})}else this.graphicRenditionIndex[b]=[{index:0}];return this.renderTimeout||(this.renderTimeout=setTimeout(function(){e.render(),e.renderTimeout=0},25)),a.substr(d.length,a.length)},u.prototype.clear=function(){this._linePlainText="",this.graphicRenditionIndex={},this.render()},u.prototype.remove=function(){this._lineElement.parentNode&&this._lineElement.parentNode.removeChild(this._lineElement)};var v=function(a){this.TERMINAL=a,this.THEMES={"default":["\x1b[38;5;226m","\x1b[38;5;226m","\x1b[38;5;76m","\x1b[38;5;51m","\x1b[38;5;111m","\x1b[38;5;9m","\x1b[38;5;180m","\x1b[38;5;51m","\x1b[0m","\x1b[38;5;39m"],cache:["\x1b[38;5;166m","\x1b[38;5;16m","\x1b[38;5;28m","\x1b[38;5;16m","\x1b[38;5;12m","\x1b[38;5;9m","\x1b[38;5;20m","\x1b[38;5;12m","\x1b[0m","\x1b[38;5;12m"]},this._SPEC_ETC_POS=8,this._SPEC_KEYWORD_POS=9,this.SYNTAX_REGULAR_EXPRESSION=new RegExp('(\\/[a-z]+)|([\\[\\]\\{\\}\\(\\)\\-\\+\\*\\/_=])|("[^"]*")|([0-9]\\.?[0-9]*)|(\\${1,3}[\\w]+)|(\\^[\\w]+)|(#{2,3}[\\w]+)|(\\.{2}[\\w]+)|([\\w]+)',"g")};v.prototype.highlightSyntax=function(a,b){var c=this;return c.THEMES[b]||(b="default"),a.replace(this.SYNTAX_REGULAR_EXPRESSION,function(a){var d;for(d=1;d<arguments.length-1;d++)if(arguments[d])return d-1===c._SPEC_ETC_POS&&c.TERMINAL.dictionary.KEYWORDS.hasOwnProperty(a)?c.THEMES[b][c._SPEC_KEYWORD_POS]+a+"\x1b[0m":c.THEMES[b][d-1]+a+"\x1b[0m";return a})};var w=function(a){this.TERMINAL=a,this.SHOW_PROGRESS_INDICATOR=!0,this.HIGHLIGHT_INPUT=!0,this.AUTOCOMPLETE=!0,this.initialize()};w.prototype.STORAGE_NAME_SHOW_PROGRESS_INDICATOR="terminal-showProgressIndicator",w.prototype.STORAGE_NAME_HIGHLIGHT_INPUT="terminal-highlightInput",w.prototype.STORAGE_NAME_AUTOCOMPLETE="terminal-autocomplete",w.prototype.initialize=function(){var a=this,b=function(a){return"true"===a?!0:"false"===a?!1:!1},c=function(c,d){a[c]=null===a[c]?d:b(a[c])};this.SHOW_PROGRESS_INDICATOR=this.TERMINAL.storage.get(this.STORAGE_NAME_SHOW_PROGRESS_INDICATOR),c("SHOW_PROGRESS_INDICATOR",!0),this.HIGHLIGHT_INPUT=this.TERMINAL.storage.get(this.STORAGE_NAME_HIGHLIGHT_INPUT),c("HIGHLIGHT_INPUT",!0),this.AUTOCOMPLETE=this.TERMINAL.storage.get(this.STORAGE_NAME_AUTOCOMPLETE),c("AUTOCOMPLETE",!0)},w.prototype.setShowProgressIndicator=function(a){return this.SHOW_PROGRESS_INDICATOR=a,this.TERMINAL.storage.set(this.STORAGE_NAME_SHOW_PROGRESS_INDICATOR,a.toString()),a},w.prototype.setHighlightInput=function(a){return this.HIGHLIGHT_INPUT=a,this.TERMINAL.storage.set(this.STORAGE_NAME_HIGHLIGHT_INPUT,a.toString()),a},w.prototype.setAutocomplete=function(a){return this.AUTOCOMPLETE=a,this.TERMINAL.storage.set(this.STORAGE_NAME_AUTOCOMPLETE,a.toString()),a};var x=function(){if("undefined"==typeof JSON)throw new Error("Browser does not support html5 local storage. Please, update your browser")};x.prototype.clear=function(){localStorage.clear()},x.prototype.set=function(a,b){localStorage.setItem(a,b)},x.prototype.remove=function(a){localStorage.removeItem(a)},x.prototype.get=function(a){return localStorage.getItem(a)};var y=function(a){this.TERMINAL=a,this.AVAILABLE_THEMES={"":"","default":"",cache:"css/terminal-theme-cache.css"},this._CURRENT_THEME="default",this.initialize()};y.prototype.STORAGE_NAME="terminal-theme",y.prototype.initialize=function(){var a;(a=this.TERMINAL.storage.get(this.STORAGE_NAME))&&this.setTheme(a)},y.prototype.getCurrentTheme=function(){return this._CURRENT_THEME||"default"},y.prototype.getAvailableList=function(){var a,b=[];for(a in this.AVAILABLE_THEMES)a&&b.push(a);return b},y.prototype.setTheme=function(a){var b;return this.AVAILABLE_THEMES.hasOwnProperty(a)?((b=this.AVAILABLE_THEMES[a])?(this.TERMINAL.elements.themeLink.setAttribute("href",b),this._CURRENT_THEME=a,this.TERMINAL.storage.set(this.STORAGE_NAME,a)):(this.TERMINAL.storage.remove(this.STORAGE_NAME),this._CURRENT_THEME="default",this.TERMINAL.elements.themeLink.removeAttribute("href")),!0):!1}}({},function(){return this}());]]></CSP>
</Export>
